<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Django REST Framework é›¶åŸºç¡€å®Œæ•´æ•™ç¨‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'SimSun', Arial, sans-serif;
            line-height: 1.8;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            padding-bottom: 20px;
            border-bottom: 3px solid #667eea;
        }
        
        h2 {
            color: #764ba2;
            font-size: 1.8em;
            margin-top: 50px;
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 5px solid #667eea;
        }
        
        h3 {
            color: #555;
            font-size: 1.5em;
            margin-top: 35px;
            margin-bottom: 15px;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
        }
        
        h4 {
            color: #666;
            font-size: 1.2em;
            margin-top: 25px;
            margin-bottom: 10px;
        }
        
        p {
            margin-bottom: 15px;
            text-indent: 0;
        }
        
        .intro {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .intro p {
            font-size: 1.1em;
            color: #555;
            margin: 10px 0;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            color: #d63384;
            font-size: 0.9em;
        }
        
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
            border-left: 4px solid #667eea;
            position: relative;
        }
        
        pre code {
            background: none;
            color: inherit;
            padding: 0;
        }
        
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .note strong {
            color: #856404;
        }
        
        .warning {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning strong {
            color: #721c24;
        }
        
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .success strong {
            color: #155724;
        }
        
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .info strong {
            color: #0c5460;
        }
        
        .concept-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .concept-box h4 {
            color: #667eea;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .screenshot {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
        }
        
        .screenshot-placeholder {
            background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%);
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 1.1em;
            border-radius: 5px;
            margin-bottom: 10px;
            flex-direction: column;
        }
        
        .screenshot-placeholder .icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        ul, ol {
            margin-left: 25px;
            margin-bottom: 20px;
        }
        
        li {
            margin-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #667eea;
            color: white;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .toc {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 8px;
            margin: 30px 0;
            border: 2px solid #667eea;
        }
        
        .toc h2 {
            margin-top: 0;
            text-align: center;
        }
        
        .toc ul {
            list-style: none;
            margin-left: 0;
        }
        
        .toc > ul > li {
            margin: 12px 0;
            font-weight: bold;
        }
        
        .toc ul ul {
            margin-left: 20px;
            margin-top: 8px;
        }
        
        .toc ul ul li {
            font-weight: normal;
            margin: 6px 0;
        }
        
        .toc a {
            color: #667eea;
            text-decoration: none;
        }
        
        .toc a:hover {
            text-decoration: underline;
        }
        
        .example-section {
            background: #fff;
            border: 2px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .example-section h4 {
            color: #28a745;
            margin-top: 0;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Django REST Framework é›¶åŸºç¡€å®Œæ•´æ•™ç¨‹</h1>
        
        <div class="intro">
            <p><strong>ğŸ¯ é€‚åˆäººç¾¤ï¼š</strong>PythonåŸºç¡€ + Djangoåˆå­¦è€…</p>
            <p><strong>ğŸ“¦ ç‰ˆæœ¬ä¿¡æ¯ï¼š</strong>Django 5.x + DRF 3.15 + MySQL + JWT</p>
            <p><strong>âœ¨ å­¦ä¹ ç›®æ ‡ï¼š</strong>ä»é›¶æŒæ¡RESTful APIå¼€å‘ï¼Œæ„å»ºå®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ</p>
            <p><strong>â±ï¸ é¢„è®¡æ—¶é—´ï¼š</strong>6-8å°æ—¶ï¼ˆåŒ…å«å®æˆ˜ç»ƒä¹ ï¼‰</p>
        </div>

        <div class="toc">
            <h2>ğŸ“š å®Œæ•´ç›®å½•</h2>
            <ul>
                <li><a href="#part1">ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µç¯‡</a>
                    <ul>
                        <li><a href="#what-is-rest">1.1 ä»€ä¹ˆæ˜¯RESTå’ŒRESTful API</a></li>
                        <li><a href="#what-is-drf">1.2 ä»€ä¹ˆæ˜¯Django REST Framework</a></li>
                        <li><a href="#http-methods">1.3 HTTPè¯·æ±‚æ–¹æ³•è¯¦è§£</a></li>
                        <li><a href="#status-codes">1.4 HTTPçŠ¶æ€ç è¯¦è§£</a></li>
                    </ul>
                </li>
                <li><a href="#part2">ç¬¬äºŒéƒ¨åˆ†ï¼šç¯å¢ƒæ­å»ºç¯‡</a>
                    <ul>
                        <li><a href="#env-setup">2.1 Pythonå’Œè™šæ‹Ÿç¯å¢ƒ</a></li>
                        <li><a href="#install-packages">2.2 å®‰è£…å¿…è¦çš„åŒ…</a></li>
                        <li><a href="#mysql-setup">2.3 é…ç½®MySQLæ•°æ®åº“</a></li>
                    </ul>
                </li>
                <li><a href="#part3">ç¬¬ä¸‰éƒ¨åˆ†ï¼šDRFæ ¸å¿ƒç»„ä»¶è¯¦è§£</a>
                    <ul>
                        <li><a href="#serializers">3.1 åºåˆ—åŒ–å™¨ï¼ˆSerializersï¼‰æ·±åº¦è®²è§£</a></li>
                        <li><a href="#views">3.2 è§†å›¾ï¼ˆViewsï¼‰å®Œå…¨æŒ‡å—</a></li>
                        <li><a href="#viewsets">3.3 è§†å›¾é›†ï¼ˆViewSetsï¼‰è¯¦è§£</a></li>
                        <li><a href="#routers">3.4 è·¯ç”±å™¨ï¼ˆRoutersï¼‰ä½¿ç”¨</a></li>
                        <li><a href="#authentication">3.5 è®¤è¯ï¼ˆAuthenticationï¼‰æœºåˆ¶</a></li>
                        <li><a href="#permissions">3.6 æƒé™ï¼ˆPermissionsï¼‰æ§åˆ¶</a></li>
                        <li><a href="#filtering">3.7 è¿‡æ»¤ã€æœç´¢å’Œæ’åº</a></li>
                        <li><a href="#pagination">3.8 åˆ†é¡µï¼ˆPaginationï¼‰</a></li>
                    </ul>
                </li>
                <li><a href="#part4">ç¬¬å››éƒ¨åˆ†ï¼šå®Œæ•´é¡¹ç›®å®æˆ˜</a>
                    <ul>
                        <li><a href="#project-init">4.1 é¡¹ç›®åˆå§‹åŒ–</a></li>
                        <li><a href="#user-system">4.2 ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆæ³¨å†Œ/ç™»å½•/JWTï¼‰</a></li>
                        <li><a href="#blog-system">4.3 åšå®¢ç³»ç»Ÿå¼€å‘</a></li>
                        <li><a href="#api-testing">4.4 APIæµ‹è¯•</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- ==================== ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µ ==================== -->
        <h2 id="part1">ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µç¯‡</h2>
        
        <h3 id="what-is-rest">1.1 ä»€ä¹ˆæ˜¯RESTå’ŒRESTful API</h3>
        
        <div class="concept-box">
            <h4>ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µï¼šREST</h4>
            <p><strong>REST</strong>ï¼ˆRepresentational State Transferï¼Œè¡¨ç°å±‚çŠ¶æ€è½¬æ¢ï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œç”¨äºè®¾è®¡ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</p>
            
            <p><strong>ç®€å•ç†è§£ï¼š</strong></p>
            <ul>
                <li>æŠŠæœåŠ¡å™¨ä¸Šçš„èµ„æºï¼ˆæ•°æ®ï¼‰çœ‹ä½œ"èµ„æº"ï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰å”¯ä¸€çš„URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰</li>
                <li>å®¢æˆ·ç«¯é€šè¿‡HTTPæ–¹æ³•ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰å¯¹èµ„æºè¿›è¡Œæ“ä½œ</li>
                <li>æœåŠ¡å™¨è¿”å›æ ‡å‡†çš„HTTPçŠ¶æ€ç å’ŒJSON/XMLæ ¼å¼çš„æ•°æ®</li>
            </ul>
        </div>

        <div class="example-section">
            <h4>ğŸŒ° ç”Ÿæ´»ä¸­çš„ä¾‹å­</h4>
            <p>æƒ³è±¡ä¸€ä¸ªå›¾ä¹¦é¦†ç³»ç»Ÿï¼š</p>
            <ul>
                <li><strong>èµ„æºï¼š</strong>å›¾ä¹¦ï¼ˆBookï¼‰</li>
                <li><strong>æŸ¥çœ‹æ‰€æœ‰å›¾ä¹¦ï¼š</strong>GET /books/</li>
                <li><strong>æŸ¥çœ‹æŸæœ¬å›¾ä¹¦ï¼š</strong>GET /books/1/</li>
                <li><strong>æ·»åŠ æ–°å›¾ä¹¦ï¼š</strong>POST /books/</li>
                <li><strong>æ›´æ–°å›¾ä¹¦ä¿¡æ¯ï¼š</strong>PUT /books/1/</li>
                <li><strong>åˆ é™¤å›¾ä¹¦ï¼š</strong>DELETE /books/1/</li>
            </ul>
        </div>

        <div class="info">
            <strong>ğŸ¯ RESTful APIçš„6ä¸ªçº¦æŸï¼š</strong>
            <ol>
                <li><strong>å®¢æˆ·ç«¯-æœåŠ¡å™¨åˆ†ç¦»ï¼š</strong>å‰åç«¯ç‹¬ç«‹å¼€å‘</li>
                <li><strong>æ— çŠ¶æ€ï¼š</strong>æ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«å®Œæ•´ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜å®¢æˆ·ç«¯çŠ¶æ€</li>
                <li><strong>å¯ç¼“å­˜ï¼š</strong>å“åº”æ•°æ®å¯ä»¥è¢«ç¼“å­˜ä»¥æé«˜æ€§èƒ½</li>
                <li><strong>ç»Ÿä¸€æ¥å£ï¼š</strong>ä½¿ç”¨æ ‡å‡†çš„HTTPæ–¹æ³•å’ŒçŠ¶æ€ç </li>
                <li><strong>åˆ†å±‚ç³»ç»Ÿï¼š</strong>å¯ä»¥æœ‰å¤šå±‚æ¶æ„ï¼ˆè´Ÿè½½å‡è¡¡ã€ç½‘å…³ç­‰ï¼‰</li>
                <li><strong>æŒ‰éœ€ä»£ç ï¼ˆå¯é€‰ï¼‰ï¼š</strong>æœåŠ¡å™¨å¯ä»¥è¿”å›å¯æ‰§è¡Œä»£ç </li>
            </ol>
        </div>

        <h3 id="what-is-drf">1.2 ä»€ä¹ˆæ˜¯Django REST Framework</h3>
        
        <div class="concept-box">
            <h4>ğŸ› ï¸ DRFæ˜¯ä»€ä¹ˆï¼Ÿ</h4>
            <p><strong>Django REST Frameworkï¼ˆDRFï¼‰</strong>æ˜¯åŸºäºDjangoçš„å¼ºå¤§å·¥å…·åŒ…ï¼Œç”¨äºå¿«é€Ÿæ„å»ºWeb APIã€‚</p>
            
            <p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨DRFï¼Ÿ</strong></p>
            <ul>
                <li>âœ… æä¾›äº†å¯è§†åŒ–çš„APIæµè§ˆç•Œé¢ï¼Œæ–¹ä¾¿æµ‹è¯•</li>
                <li>âœ… å¼ºå¤§çš„åºåˆ—åŒ–ç³»ç»Ÿï¼Œè½»æ¾å¤„ç†å¤æ‚æ•°æ®</li>
                <li>âœ… å†…ç½®è®¤è¯å’Œæƒé™ç³»ç»Ÿ</li>
                <li>âœ… è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£</li>
                <li>âœ… æ”¯æŒå¤šç§æ•°æ®æ ¼å¼ï¼ˆJSONã€XMLç­‰ï¼‰</li>
                <li>âœ… ä¸°å¯Œçš„è§†å›¾ç±»å’Œè§†å›¾é›†ï¼Œå‡å°‘ä»£ç é‡</li>
            </ul>
        </div>

        <h3 id="http-methods">1.3 HTTPè¯·æ±‚æ–¹æ³•è¯¦è§£</h3>
        
        <p>HTTPå®šä¹‰äº†ä¸€ç»„è¯·æ±‚æ–¹æ³•ï¼Œç”¨æ¥æŒ‡å®šå¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œã€‚åœ¨RESTful APIä¸­ï¼Œè¿™äº›æ–¹æ³•æœ‰ç‰¹å®šçš„å«ä¹‰ï¼š</p>
        
        <table>
            <tr>
                <th>HTTPæ–¹æ³•</th>
                <th>ä½œç”¨</th>
                <th>ç¤ºä¾‹</th>
                <th>æ˜¯å¦å¹‚ç­‰</th>
            </tr>
            <tr>
                <td><strong>GET</strong></td>
                <td>è·å–èµ„æº</td>
                <td>GET /users/ è·å–ç”¨æˆ·åˆ—è¡¨<br>GET /users/1/ è·å–IDä¸º1çš„ç”¨æˆ·</td>
                <td>âœ… æ˜¯</td>
            </tr>
            <tr>
                <td><strong>POST</strong></td>
                <td>åˆ›å»ºèµ„æº</td>
                <td>POST /users/ åˆ›å»ºæ–°ç”¨æˆ·</td>
                <td>âŒ å¦</td>
            </tr>
            <tr>
                <td><strong>PUT</strong></td>
                <td>å®Œæ•´æ›´æ–°èµ„æº</td>
                <td>PUT /users/1/ å®Œæ•´æ›´æ–°ç”¨æˆ·ä¿¡æ¯</td>
                <td>âœ… æ˜¯</td>
            </tr>
            <tr>
                <td><strong>PATCH</strong></td>
                <td>éƒ¨åˆ†æ›´æ–°èµ„æº</td>
                <td>PATCH /users/1/ åªæ›´æ–°éƒ¨åˆ†å­—æ®µ</td>
                <td>âœ… æ˜¯</td>
            </tr>
            <tr>
                <td><strong>DELETE</strong></td>
                <td>åˆ é™¤èµ„æº</td>
                <td>DELETE /users/1/ åˆ é™¤ç”¨æˆ·</td>
                <td>âœ… æ˜¯</td>
            </tr>
        </table>

        <div class="note">
            <strong>ğŸ’¡ ä»€ä¹ˆæ˜¯å¹‚ç­‰æ€§ï¼Ÿ</strong>
            <p>å¹‚ç­‰æ€§æ˜¯æŒ‡å¤šæ¬¡æ‰§è¡ŒåŒä¸€ä¸ªæ“ä½œï¼Œç»“æœæ˜¯ç›¸åŒçš„ã€‚ä¾‹å¦‚ï¼š</p>
            <ul>
                <li>GETè¯·æ±‚å¤šæ¬¡æŸ¥è¯¢ï¼Œç»“æœä¸€æ · â†’ å¹‚ç­‰</li>
                <li>DELETEè¯·æ±‚å¤šæ¬¡åˆ é™¤åŒä¸€èµ„æºï¼Œæœ€ç»ˆéƒ½æ˜¯è¢«åˆ é™¤ â†’ å¹‚ç­‰</li>
                <li>POSTè¯·æ±‚å¤šæ¬¡åˆ›å»ºï¼Œä¼šåˆ›å»ºå¤šä¸ªèµ„æº â†’ éå¹‚ç­‰</li>
            </ul>
        </div>

        <h3 id="status-codes">1.4 HTTPçŠ¶æ€ç è¯¦è§£</h3>
        
        <p>æœåŠ¡å™¨é€šè¿‡HTTPçŠ¶æ€ç å‘Šè¯‰å®¢æˆ·ç«¯è¯·æ±‚çš„å¤„ç†ç»“æœï¼š</p>
        
        <table>
            <tr>
                <th>çŠ¶æ€ç </th>
                <th>å«ä¹‰</th>
                <th>ä½¿ç”¨åœºæ™¯</th>
            </tr>
            <tr>
                <td colspan="3" style="background: #e7f3ff; font-weight: bold;">2xx æˆåŠŸ</td>
            </tr>
            <tr>
                <td>200 OK</td>
                <td>è¯·æ±‚æˆåŠŸ</td>
                <td>GETã€PUTã€PATCHè¯·æ±‚æˆåŠŸ</td>
            </tr>
            <tr>
                <td>201 Created</td>
                <td>èµ„æºåˆ›å»ºæˆåŠŸ</td>
                <td>POSTè¯·æ±‚åˆ›å»ºèµ„æºæˆåŠŸ</td>
            </tr>
            <tr>
                <td>204 No Content</td>
                <td>è¯·æ±‚æˆåŠŸä½†æ— è¿”å›å†…å®¹</td>
                <td>DELETEè¯·æ±‚æˆåŠŸ</td>
            </tr>
            <tr>
                <td colspan="3" style="background: #fff3cd; font-weight: bold;">4xx å®¢æˆ·ç«¯é”™è¯¯</td>
            </tr>
            <tr>
                <td>400 Bad Request</td>
                <td>è¯·æ±‚å‚æ•°é”™è¯¯</td>
                <td>è¡¨å•éªŒè¯å¤±è´¥</td>
            </tr>
            <tr>
                <td>401 Unauthorized</td>
                <td>æœªè®¤è¯</td>
                <td>éœ€è¦ç™»å½•ä½†æœªæä¾›Token</td>
            </tr>
            <tr>
                <td>403 Forbidden</td>
                <td>æ— æƒé™</td>
                <td>å·²ç™»å½•ä½†æ²¡æœ‰æƒé™è®¿é—®èµ„æº</td>
            </tr>
            <tr>
                <td>404 Not Found</td>
                <td>èµ„æºä¸å­˜åœ¨</td>
                <td>è¯·æ±‚çš„èµ„æºæ‰¾ä¸åˆ°</td>
            </tr>
            <tr>
                <td colspan="3" style="background: #f8d7da; font-weight: bold;">5xx æœåŠ¡å™¨é”™è¯¯</td>
            </tr>
            <tr>
                <td>500 Internal Server Error</td>
                <td>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯</td>
                <td>ä»£ç å¼‚å¸¸ã€æ•°æ®åº“é”™è¯¯ç­‰</td>
            </tr>
        </table>

        <!-- ==================== ç¬¬äºŒéƒ¨åˆ†ï¼šç¯å¢ƒæ­å»º ==================== -->
        <h2 id="part2">ç¬¬äºŒéƒ¨åˆ†ï¼šç¯å¢ƒæ­å»ºç¯‡</h2>
        
        <h3 id="env-setup">2.1 Pythonå’Œè™šæ‹Ÿç¯å¢ƒ</h3>
        
        <div class="concept-box">
            <h4>ğŸ¤” ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹Ÿç¯å¢ƒï¼Ÿ</h4>
            <p>è™šæ‹Ÿç¯å¢ƒæ˜¯Pythoné¡¹ç›®çš„ç‹¬ç«‹è¿è¡Œç©ºé—´ï¼Œå¥½å¤„æœ‰ï¼š</p>
            <ul>
                <li>ä¸åŒé¡¹ç›®å¯ä»¥ä½¿ç”¨ä¸åŒç‰ˆæœ¬çš„åŒ…ï¼Œäº’ä¸å¹²æ‰°</li>
                <li>é¿å…å…¨å±€å®‰è£…å¤§é‡åŒ…å¯¼è‡´æ··ä¹±</li>
                <li>æ–¹ä¾¿é¡¹ç›®è¿ç§»å’Œéƒ¨ç½²</li>
            </ul>
        </div>

        <h4>æ­¥éª¤1ï¼šæ£€æŸ¥Pythonç‰ˆæœ¬</h4>
        <pre><code># æ‰“å¼€ç»ˆç«¯/å‘½ä»¤æç¤ºç¬¦ï¼Œè¾“å…¥ï¼š
python --version
# æˆ–
python3 --version

# åº”è¯¥æ˜¾ç¤º Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬</code></pre>

        <h4>æ­¥éª¤2ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•</h4>
        <pre><code># Windows å‘½ä»¤æç¤ºç¬¦ï¼š
mkdir drf_tutorial
cd drf_tutorial

# Mac/Linux ç»ˆç«¯ï¼š
mkdir drf_tutorial
cd drf_tutorial</code></pre>

        <h4>æ­¥éª¤3ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h4>
        <pre><code># åˆ›å»ºåä¸º venv çš„è™šæ‹Ÿç¯å¢ƒ
python -m venv venv</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸ“</div>
                åˆ›å»ºåä¼šçœ‹åˆ°ä¸€ä¸ª venv æ–‡ä»¶å¤¹<br>
                åŒ…å« Scriptsï¼ˆWindowsï¼‰æˆ– binï¼ˆMac/Linuxï¼‰ç­‰å­æ–‡ä»¶å¤¹
            </div>
        </div>

        <h4>æ­¥éª¤4ï¼šæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</h4>
        <pre><code># Windows:
venv\Scripts\activate

# Mac/Linux:
source venv/bin/activate

# æ¿€æ´»æˆåŠŸåï¼Œå‘½ä»¤è¡Œå‰é¢ä¼šå‡ºç° (venv) æ ‡è¯†</code></pre>

        <div class="success">
            <strong>âœ… æ£€æŸ¥æ˜¯å¦æ¿€æ´»æˆåŠŸï¼š</strong>
            <pre><code># è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š
where python    # Windows
which python    # Mac/Linux

# åº”è¯¥æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒä¸­çš„Pythonè·¯å¾„</code></pre>
        </div>

        <h3 id="install-packages">2.2 å®‰è£…å¿…è¦çš„åŒ…</h3>
        
        <h4>å®‰è£…Djangoå’ŒDRF</h4>
        <pre><code># ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»ï¼ˆå‘½ä»¤è¡Œå‰æœ‰ (venv) æ ‡è¯†ï¼‰

# å®‰è£…Django 5.0
pip install django==5.0.1

# å®‰è£…Django REST Framework 3.15
pip install djangorestframework==3.15.0</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">â¬‡ï¸</div>
                å®‰è£…è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºä¸‹è½½è¿›åº¦<br>
                æˆåŠŸåæ˜¾ç¤º "Successfully installed..."
            </div>
        </div>

        <h4>å®‰è£…æ•°æ®åº“é©±åŠ¨</h4>
        <pre><code># å®‰è£…MySQLå®¢æˆ·ç«¯
pip install mysqlclient

# å¦‚æœå®‰è£…å¤±è´¥ï¼ˆå¸¸è§äºWindowsï¼‰ï¼Œä½¿ç”¨pymysqlæ›¿ä»£ï¼š
pip install pymysql</code></pre>

        <div class="warning">
            <strong>âš ï¸ Windowsç”¨æˆ·æ³¨æ„ï¼š</strong>
            <p>å¦‚æœå®‰è£…mysqlclientå¤±è´¥ï¼Œå¯èƒ½ç¼ºå°‘C++ç¼–è¯‘ç¯å¢ƒã€‚è§£å†³æ–¹æ¡ˆï¼š</p>
            <ol>
                <li>ä½¿ç”¨ <code>pip install pymysql</code> æ›¿ä»£</li>
                <li>åœ¨é¡¹ç›®çš„ __init__.py ä¸­æ·»åŠ ï¼š
                    <pre><code>import pymysql
pymysql.install_as_MySQLdb()</code></pre>
                </li>
            </ol>
        </div>

        <h4>å®‰è£…JWTå’Œå…¶ä»–å·¥å…·</h4>
        <pre><code># JWTè®¤è¯
pip install djangorestframework-simplejwt==5.3.1

# CORSè·¨åŸŸæ”¯æŒï¼ˆå‰åç«¯åˆ†ç¦»å¿…é¡»ï¼‰
pip install django-cors-headers

# è¿‡æ»¤å’Œæœç´¢
pip install django-filter

# APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ
pip install drf-yasg

# Pillowå›¾ç‰‡å¤„ç†ï¼ˆå¦‚æœéœ€è¦ä¸Šä¼ å¤´åƒç­‰ï¼‰
pip install Pillow</code></pre>

        <h4>å¯¼å‡ºä¾èµ–åŒ…åˆ—è¡¨</h4>
        <pre><code># å°†å®‰è£…çš„æ‰€æœ‰åŒ…ä¿å­˜åˆ°æ–‡ä»¶
pip freeze > requirements.txt

# ä»¥ååœ¨å…¶ä»–ç¯å¢ƒå®‰è£…ï¼Œåªéœ€ï¼š
pip install -r requirements.txt</code></pre>

        <div class="info">
            <strong>ğŸ“ requirements.txt ç¤ºä¾‹å†…å®¹ï¼š</strong>
            <pre><code>Django==5.0.1
djangorestframework==3.15.0
djangorestframework-simplejwt==5.3.1
django-cors-headers==4.3.1
django-filter==23.5
drf-yasg==1.21.7
mysqlclient==2.2.1
Pillow==10.2.0</code></pre>
        </div>

        <h3 id="mysql-setup">2.3 é…ç½®MySQLæ•°æ®åº“</h3>
        
        <h4>æ­¥éª¤1ï¼šå®‰è£…MySQL</h4>
        <p>è¯·è®¿é—®MySQLå®˜ç½‘ä¸‹è½½å¹¶å®‰è£…ï¼š<code>https://dev.mysql.com/downloads/</code></p>
        <ul>
            <li>é€‰æ‹©MySQL Community Server</li>
            <li>å®‰è£…æ—¶è®°ä½rootå¯†ç </li>
            <li>å»ºè®®å®‰è£…MySQL Workbenchï¼ˆå›¾å½¢åŒ–ç®¡ç†å·¥å…·ï¼‰</li>
        </ul>

        <h4>æ­¥éª¤2ï¼šåˆ›å»ºæ•°æ®åº“</h4>
        <pre><code># æ–¹æ³•1ï¼šä½¿ç”¨å‘½ä»¤è¡Œ
# 1. æ‰“å¼€ç»ˆç«¯ï¼Œç™»å½•MySQL
mysql -u root -p
# è¾“å…¥å¯†ç 

# 2. åˆ›å»ºæ•°æ®åº“
CREATE DATABASE drf_tutorial CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 3. åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå¯é€‰ï¼Œæ›´å®‰å…¨ï¼‰
CREATE USER 'drf_user'@'localhost' IDENTIFIED BY 'drf123456';

# 4. æˆäºˆæƒé™
GRANT ALL PRIVILEGES ON drf_tutorial.* TO 'drf_user'@'localhost';
FLUSH PRIVILEGES;

# 5. æŸ¥çœ‹æ•°æ®åº“
SHOW DATABASES;

# 6. é€€å‡º
EXIT;</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸ—„ï¸</div>
                MySQL Workbench æˆªå›¾<br>
                æ˜¾ç¤ºæ–°åˆ›å»ºçš„ drf_tutorial æ•°æ®åº“
            </div>
        </div>

        <div class="note">
            <strong>ğŸ’¡ å­—ç¬¦é›†è¯´æ˜ï¼š</strong>
            <ul>
                <li><strong>utf8mb4ï¼š</strong>æ”¯æŒå®Œæ•´çš„UTF-8ï¼ŒåŒ…æ‹¬emojiè¡¨æƒ…</li>
                <li><strong>utf8mb4_unicode_ciï¼š</strong>ä¸åŒºåˆ†å¤§å°å†™çš„æ’åºè§„åˆ™</li>
            </ul>
        </div>

        <!-- ==================== ç¬¬ä¸‰éƒ¨åˆ†ï¼šDRFæ ¸å¿ƒç»„ä»¶ ==================== -->
        <h2 id="part3">ç¬¬ä¸‰éƒ¨åˆ†ï¼šDRFæ ¸å¿ƒç»„ä»¶è¯¦è§£</h2>
        
        <h3 id="serializers">3.1 åºåˆ—åŒ–å™¨ï¼ˆSerializersï¼‰æ·±åº¦è®²è§£</h3>
        
        <div class="concept-box">
            <h4>ğŸ¤” ä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿ</h4>
            <p><strong>åºåˆ—åŒ–ï¼ˆSerializationï¼‰ï¼š</strong>å°†å¤æ‚çš„æ•°æ®ç±»å‹ï¼ˆå¦‚Djangoæ¨¡å‹å¯¹è±¡ï¼‰è½¬æ¢ä¸ºPythonåŸç”Ÿæ•°æ®ç±»å‹ï¼ˆå­—å…¸ã€åˆ—è¡¨ï¼‰ï¼Œç„¶åå¯ä»¥è½»æ¾è½¬æ¢ä¸ºJSONã€XMLç­‰æ ¼å¼ã€‚</p>
            <p><strong>ååºåˆ—åŒ–ï¼ˆDeserializationï¼‰ï¼š</strong>å°†JSONç­‰æ ¼å¼çš„æ•°æ®è½¬æ¢å›Pythonå¯¹è±¡ï¼Œå¹¶éªŒè¯æ•°æ®æœ‰æ•ˆæ€§ã€‚</p>
        </div>

        <div class="example-section">
            <h4>ğŸŒ° ç”Ÿæ´»ä¸­çš„ä¾‹å­</h4>
            <p>æƒ³è±¡ä½ è¦å¯„ä¸€æœ¬ä¹¦ï¼š</p>
            <ul>
                <li><strong>åºåˆ—åŒ–ï¼š</strong>æŠŠä¹¦æ‰“åŒ…æˆåŒ…è£¹ï¼ˆå¯ä»¥è¿è¾“çš„å½¢å¼ï¼‰</li>
                <li><strong>ååºåˆ—åŒ–ï¼š</strong>æ”¶åˆ°åŒ…è£¹åæ‹†å¼€ï¼Œæ¢å¤æˆä¹¦</li>
            </ul>
            <p>åœ¨APIä¸­ï¼š</p>
            <ul>
                <li><strong>åºåˆ—åŒ–ï¼š</strong>Djangoæ¨¡å‹å¯¹è±¡ â†’ JSONæ•°æ®ï¼ˆå‘é€ç»™å‰ç«¯ï¼‰</li>
                <li><strong>ååºåˆ—åŒ–ï¼š</strong>JSONæ•°æ® â†’ Djangoæ¨¡å‹å¯¹è±¡ï¼ˆä¿å­˜åˆ°æ•°æ®åº“ï¼‰</li>
            </ul>
        </div>

        <h4>3.1.1 åŸºç¡€åºåˆ—åŒ–å™¨ç¤ºä¾‹</h4>
        
        <p>åˆ›å»ºä¸€ä¸ªç®€å•çš„å›¾ä¹¦åºåˆ—åŒ–å™¨ï¼š</p>
        <pre><code># å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªBookæ¨¡å‹
from django.db import models

class Book(models.Model):
    """å›¾ä¹¦æ¨¡å‹"""
    title = models.CharField(max_length=200, verbose_name='ä¹¦å')
    author = models.CharField(max_length=100, verbose_name='ä½œè€…')
    price = models.DecimalField(max_digits=6, decimal_places=2, verbose_name='ä»·æ ¼')
    published_date = models.DateField(verbose_name='å‡ºç‰ˆæ—¥æœŸ')
    
    def __str__(self):
        return self.title


# serializers.py - åˆ›å»ºåºåˆ—åŒ–å™¨
from rest_framework import serializers
from .models import Book

class BookSerializer(serializers.ModelSerializer):
    """
    å›¾ä¹¦åºåˆ—åŒ–å™¨
    ModelSerializerä¼šè‡ªåŠ¨æ ¹æ®æ¨¡å‹ç”Ÿæˆå­—æ®µ
    """
    class Meta:
        model = Book  # æŒ‡å®šæ¨¡å‹
        fields = '__all__'  # åŒ…å«æ‰€æœ‰å­—æ®µ
        # æˆ–è€…æŒ‡å®šå…·ä½“å­—æ®µï¼š
        # fields = ['id', 'title', 'author', 'price', 'published_date']
        # æˆ–è€…æ’é™¤æŸäº›å­—æ®µï¼š
        # exclude = ['id']</code></pre>

        <div class="info">
            <strong>ğŸ“Œ ModelSerializer vs Serializerï¼š</strong>
            <ul>
                <li><strong>ModelSerializerï¼š</strong>åŸºäºDjangoæ¨¡å‹è‡ªåŠ¨ç”Ÿæˆå­—æ®µï¼Œè‡ªå¸¦create()å’Œupdate()æ–¹æ³•</li>
                <li><strong>Serializerï¼š</strong>éœ€è¦æ‰‹åŠ¨å®šä¹‰æ‰€æœ‰å­—æ®µï¼Œé€‚åˆéæ¨¡å‹æ•°æ®</li>
            </ul>
        </div>

        <h4>3.1.2 åºåˆ—åŒ–å™¨çš„æ ¸å¿ƒåŠŸèƒ½</h4>
        
        <p><strong>åŠŸèƒ½1ï¼šæ•°æ®éªŒè¯</strong></p>
        <pre><code>from rest_framework import serializers

class BookSerializer(serializers.ModelSerializer):
    class Meta:
        model = Book
        fields = '__all__'
    
    def validate_price(self, value):
        """
        éªŒè¯ä»·æ ¼å­—æ®µ
        æ–¹æ³•åæ ¼å¼ï¼švalidate_å­—æ®µå
        """
        if value < 0:
            raise serializers.ValidationError('ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°')
        if value > 10000:
            raise serializers.ValidationError('ä»·æ ¼ä¸èƒ½è¶…è¿‡10000å…ƒ')
        return value
    
    def validate(self, attrs):
        """
        å¤šå­—æ®µè”åˆéªŒè¯
        attrsæ˜¯åŒ…å«æ‰€æœ‰å­—æ®µçš„å­—å…¸
        """
        if attrs.get('published_date') and attrs['published_date'].year < 1900:
            raise serializers.ValidationError('å‡ºç‰ˆæ—¥æœŸä¸èƒ½æ—©äº1900å¹´')
        return attrs</code></pre>

        <div class="example-section">
            <h4>ğŸ” éªŒè¯æµç¨‹æ¼”ç¤º</h4>
            <pre><code># åˆ›å»ºåºåˆ—åŒ–å™¨å®ä¾‹
data = {
    'title': 'Pythonç¼–ç¨‹',
    'author': 'å¼ ä¸‰',
    'price': -10,  # é”™è¯¯ï¼šè´Ÿæ•°
    'published_date': '2024-01-01'
}

serializer = BookSerializer(data=data)

# éªŒè¯æ•°æ®
if serializer.is_valid():
    # éªŒè¯é€šè¿‡ï¼Œä¿å­˜æ•°æ®
    serializer.save()
    print('ä¿å­˜æˆåŠŸ')
else:
    # éªŒè¯å¤±è´¥ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯
    print(serializer.errors)
    # è¾“å‡ºï¼š{'price': ['ä»·æ ¼ä¸èƒ½ä¸ºè´Ÿæ•°']}</code></pre>
        </div>

        <p><strong>åŠŸèƒ½2ï¼šè‡ªå®šä¹‰å­—æ®µ</strong></p>
        <pre><code>class BookSerializer(serializers.ModelSerializer):
    # åªè¯»å­—æ®µï¼ˆåªç”¨äºè¾“å‡ºï¼Œä¸æ¥å—è¾“å…¥ï¼‰
    id = serializers.IntegerField(read_only=True)
    
    # åªå†™å­—æ®µï¼ˆåªæ¥å—è¾“å…¥ï¼Œä¸è¾“å‡ºï¼‰
    password = serializers.CharField(write_only=True)
    
    # è‡ªå®šä¹‰SerializerMethodFieldï¼ˆéœ€è¦å®šä¹‰get_æ–¹æ³•ï¼‰
    full_info = serializers.SerializerMethodField()
    
    # è®¾ç½®å¿…å¡«å’Œéå¿…å¡«
    author = serializers.CharField(required=True)  # å¿…å¡«
    isbn = serializers.CharField(required=False)   # éå¿…å¡«
    
    # è®¾ç½®é»˜è®¤å€¼
    status = serializers.CharField(default='available')
    
    class Meta:
        model = Book
        fields = ['id', 'title', 'author', 'isbn', 'full_info', 'status']
    
    def get_full_info(self, obj):
        """
        SerializerMethodFieldçš„å®ç°æ–¹æ³•
        æ–¹æ³•åæ ¼å¼ï¼šget_å­—æ®µå
        objæ˜¯æ¨¡å‹å®ä¾‹
        """
        return f"{obj.title} - {obj.author}"</code></pre>

        <p><strong>åŠŸèƒ½3ï¼šåµŒå¥—åºåˆ—åŒ–</strong></p>
        <pre><code># å‡è®¾æœ‰ä½œè€…æ¨¡å‹
class Author(models.Model):
    name = models.CharField(max_length=100)
    email = models.EmailField()

class Book(models.Model):
    title = models.CharField(max_length=200)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
    price = models.DecimalField(max_digits=6, decimal_places=2)


# åºåˆ—åŒ–å™¨
class AuthorSerializer(serializers.ModelSerializer):
    """ä½œè€…åºåˆ—åŒ–å™¨"""
    class Meta:
        model = Author
        fields = ['id', 'name', 'email']

class BookSerializer(serializers.ModelSerializer):
    """å›¾ä¹¦åºåˆ—åŒ–å™¨ - åŒ…å«åµŒå¥—çš„ä½œè€…ä¿¡æ¯"""
    # åµŒå¥—åºåˆ—åŒ–å™¨ï¼ˆä¼šæ˜¾ç¤ºä½œè€…çš„å®Œæ•´ä¿¡æ¯ï¼‰
    author = AuthorSerializer(read_only=True)
    
    # å¦‚æœåªæƒ³æ˜¾ç¤ºä½œè€…IDï¼ˆç”¨äºåˆ›å»º/æ›´æ–°ï¼‰
    author_id = serializers.IntegerField(write_only=True)
    
    class Meta:
        model = Book
        fields = ['id', 'title', 'author', 'author_id', 'price']</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸ“Š</div>
                åµŒå¥—åºåˆ—åŒ–å™¨è¾“å‡ºç¤ºä¾‹ï¼š<br>
                <pre style="text-align: left; background: white; color: #333; padding: 10px; margin-top: 10px;">{
    "id": 1,
    "title": "Pythonç¼–ç¨‹",
    "author": {
        "id": 1,
        "name": "å¼ ä¸‰",
        "email": "zhangsan@example.com"
    },
    "price": "99.00"
}</pre>
            </div>
        </div>

        <h4>3.1.3 åºåˆ—åŒ–å™¨çš„å¸¸ç”¨å­—æ®µç±»å‹</h4>
        
        <table>
            <tr>
                <th>å­—æ®µç±»å‹</th>
                <th>è¯´æ˜</th>
                <th>ç¤ºä¾‹</th>
            </tr>
            <tr>
                <td>CharField</td>
                <td>å­—ç¬¦ä¸²</td>
                <td><code>name = serializers.CharField(max_length=100)</code></td>
            </tr>
            <tr>
                <td>IntegerField</td>
                <td>æ•´æ•°</td>
                <td><code>age = serializers.IntegerField(min_value=0)</code></td>
            </tr>
            <tr>
                <td>FloatField</td>
                <td>æµ®ç‚¹æ•°</td>
                <td><code>score = serializers.FloatField()</code></td>
            </tr>
            <tr>
                <td>DecimalField</td>
                <td>ç²¾ç¡®å°æ•°ï¼ˆç”¨äºé‡‘é¢ï¼‰</td>
                <td><code>price = serializers.DecimalField(max_digits=6, decimal_places=2)</code></td>
            </tr>
            <tr>
                <td>BooleanField</td>
                <td>å¸ƒå°”å€¼</td>
                <td><code>is_active = serializers.BooleanField()</code></td>
            </tr>
            <tr>
                <td>DateField</td>
                <td>æ—¥æœŸ</td>
                <td><code>birth_date = serializers.DateField()</code></td>
            </tr>
            <tr>
                <td>DateTimeField</td>
                <td>æ—¥æœŸæ—¶é—´</td>
                <td><code>created_at = serializers.DateTimeField()</code></td>
            </tr>
            <tr>
                <td>EmailField</td>
                <td>é‚®ç®±ï¼ˆè‡ªåŠ¨éªŒè¯æ ¼å¼ï¼‰</td>
                <td><code>email = serializers.EmailField()</code></td>
            </tr>
            <tr>
                <td>URLField</td>
                <td>URLï¼ˆè‡ªåŠ¨éªŒè¯æ ¼å¼ï¼‰</td>
                <td><code>website = serializers.URLField()</code></td>
            </tr>
            <tr>
                <td>FileField</td>
                <td>æ–‡ä»¶ä¸Šä¼ </td>
                <td><code>file = serializers.FileField()</code></td>
            </tr>
            <tr>
                <td>ImageField</td>
                <td>å›¾ç‰‡ä¸Šä¼ </td>
                <td><code>avatar = serializers.ImageField()</code></td>
            </tr>
            <tr>
                <td>ListField</td>
                <td>åˆ—è¡¨</td>
                <td><code>tags = serializers.ListField(child=serializers.CharField())</code></td>
            </tr>
            <tr>
                <td>ChoiceField</td>
                <td>é€‰æ‹©å­—æ®µ</td>
                <td><code>status = serializers.ChoiceField(choices=['draft', 'published'])</code></td>
            </tr>
        </table>

        <h3 id="views">3.2 è§†å›¾ï¼ˆViewsï¼‰å®Œå…¨æŒ‡å—</h3>
        
        <div class="concept-box">
            <h4>ğŸ¯ ä»€ä¹ˆæ˜¯è§†å›¾ï¼Ÿ</h4>
            <p><strong>è§†å›¾ï¼ˆViewï¼‰</strong>æ˜¯å¤„ç†HTTPè¯·æ±‚å¹¶è¿”å›HTTPå“åº”çš„å‡½æ•°æˆ–ç±»ã€‚åœ¨DRFä¸­ï¼Œè§†å›¾è´Ÿè´£ï¼š</p>
            <ul>
                <li>æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚</li>
                <li>è°ƒç”¨åºåˆ—åŒ–å™¨å¤„ç†æ•°æ®</li>
                <li>æ‰§è¡Œä¸šåŠ¡é€»è¾‘</li>
                <li>è¿”å›å“åº”</li>
            </ul>
        </div>

        <h4>3.2.1 è§†å›¾çš„æ¼”è¿›å±‚æ¬¡</h4>
        
        <p>DRFæä¾›äº†å¤šä¸ªå±‚æ¬¡çš„è§†å›¾ï¼Œä»åº•å±‚åˆ°é«˜å±‚ï¼š</p>
        
        <div class="info">
            <strong>ğŸ“Š è§†å›¾å±‚æ¬¡ï¼š</strong>
            <ol>
                <li><strong>@api_viewè£…é¥°å™¨</strong> - å‡½æ•°è§†å›¾ï¼Œæœ€çµæ´»</li>
                <li><strong>APIViewç±»</strong> - åŸºç¡€ç±»è§†å›¾</li>
                <li><strong>GenericAPIView + Mixins</strong> - é€šç”¨è§†å›¾ + æ··å…¥ç±»</li>
                <li><strong>é€šç”¨è§†å›¾ç±»</strong> - é¢„å®šä¹‰çš„å¸¸ç”¨è§†å›¾</li>
                <li><strong>ViewSet</strong> - è§†å›¾é›†ï¼Œæœ€ç®€æ´ï¼ˆåé¢è¯¦è®²ï¼‰</li>
            </ol>
        </div>

        <p><strong>å±‚æ¬¡1ï¼šä½¿ç”¨@api_viewè£…é¥°å™¨ï¼ˆå‡½æ•°è§†å›¾ï¼‰</strong></p>
        <pre><code>from rest_framework.decorators import api_view
from rest_framework.response import Response
from rest_framework import status
from .models import Book
from .serializers import BookSerializer

@api_view(['GET', 'POST'])  # æŒ‡å®šå…è®¸çš„HTTPæ–¹æ³•
def book_list(request):
    """
    è·å–æ‰€æœ‰å›¾ä¹¦æˆ–åˆ›å»ºæ–°å›¾ä¹¦
    GET /books/ - è·å–åˆ—è¡¨
    POST /books/ - åˆ›å»ºæ–°å›¾ä¹¦
    """
    if request.method == 'GET':
        # è·å–æ‰€æœ‰å›¾ä¹¦
        books = Book.objects.all()
        # åºåˆ—åŒ–ï¼ˆmany=Trueè¡¨ç¤ºåºåˆ—åŒ–å¤šä¸ªå¯¹è±¡ï¼‰
        serializer = BookSerializer(books, many=True)
        # è¿”å›å“åº”
        return Response(serializer.data)
    
    elif request.method == 'POST':
        # åˆ›å»ºæ–°å›¾ä¹¦
        # request.dataåŒ…å«POSTè¯·æ±‚çš„æ•°æ®
        serializer = BookSerializer(data=request.data)
        # éªŒè¯æ•°æ®
        if serializer.is_valid():
            # ä¿å­˜åˆ°æ•°æ®åº“
            serializer.save()
            # è¿”å›201çŠ¶æ€ç 
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        # éªŒè¯å¤±è´¥ï¼Œè¿”å›400é”™è¯¯
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)


@api_view(['GET', 'PUT', 'DELETE'])
def book_detail(request, pk):
    """
    è·å–ã€æ›´æ–°æˆ–åˆ é™¤å•ä¸ªå›¾ä¹¦
    GET /books/1/ - è·å–è¯¦æƒ…
    PUT /books/1/ - æ›´æ–°
    DELETE /books/1/ - åˆ é™¤
    """
    try:
        # è·å–æŒ‡å®šIDçš„å›¾ä¹¦
        book = Book.objects.get(pk=pk)
    except Book.DoesNotExist:
        # å›¾ä¹¦ä¸å­˜åœ¨ï¼Œè¿”å›404
        return Response(
            {'error': 'å›¾ä¹¦ä¸å­˜åœ¨'}, 
            status=status.HTTP_404_NOT_FOUND
        )
    
    if request.method == 'GET':
        # åºåˆ—åŒ–å•ä¸ªå¯¹è±¡ï¼ˆä¸éœ€è¦many=Trueï¼‰
        serializer = BookSerializer(book)
        return Response(serializer.data)
    
    elif request.method == 'PUT':
        # æ›´æ–°å›¾ä¹¦ï¼ˆä¼ å…¥instanceå’Œdataï¼‰
        serializer = BookSerializer(book, data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
    
    elif request.method == 'DELETE':
        # åˆ é™¤å›¾ä¹¦
        book.delete()
        # è¿”å›204çŠ¶æ€ç ï¼ˆæ— å†…å®¹ï¼‰
        return Response(status=status.HTTP_204_NO_CONTENT)</code></pre>

        <p><strong>å±‚æ¬¡2ï¼šä½¿ç”¨APIViewç±»</strong></p>
        <pre><code>from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from .models import Book
from .serializers import BookSerializer

class BookListView(APIView):
    """
    å›¾ä¹¦åˆ—è¡¨è§†å›¾
    ä½¿ç”¨ç±»è§†å›¾å¯ä»¥æ›´å¥½åœ°ç»„ç»‡ä»£ç 
    """
    def get(self, request):
        """å¤„ç†GETè¯·æ±‚ - è·å–åˆ—è¡¨"""
        books = Book.objects.all()
        serializer = BookSerializer(books, many=True)
        return Response(serializer.data)
    
    def post(self, request):
        """å¤„ç†POSTè¯·æ±‚ - åˆ›å»ºæ–°å›¾ä¹¦"""
        serializer = BookSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)


class BookDetailView(APIView):
    """å›¾ä¹¦è¯¦æƒ…è§†å›¾"""
    
    def get_object(self, pk):
        """
        è¾…åŠ©æ–¹æ³•ï¼šè·å–å›¾ä¹¦å¯¹è±¡
        """
        try:
            return Book.objects.get(pk=pk)
        except Book.DoesNotExist:
            return None
    
    def get(self, request, pk):
        """å¤„ç†GETè¯·æ±‚ - è·å–è¯¦æƒ…"""
        book = self.get_object(pk)
        if book is None:
            return Response(
                {'error': 'å›¾ä¹¦ä¸å­˜åœ¨'}, 
                status=status.HTTP_404_NOT_FOUND
            )
        serializer = BookSerializer(book)
        return Response(serializer.data)
    
    def put(self, request, pk):
        """å¤„ç†PUTè¯·æ±‚ - æ›´æ–°"""
        book = self.get_object(pk)
        if book is None:
            return Response(
                {'error': 'å›¾ä¹¦ä¸å­˜åœ¨'}, 
                status=status.HTTP_404_NOT_FOUND
            )
        serializer = BookSerializer(book, data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
    
    def delete(self, request, pk):
        """å¤„ç†DELETEè¯·æ±‚ - åˆ é™¤"""
        book = self.get_object(pk)
        if book is None:
            return Response(
                {'error': 'å›¾ä¹¦ä¸å­˜åœ¨'}, 
                status=status.HTTP_404_NOT_FOUND
            )
        book.delete()
        return Response(status=status.HTTP_204_NO_CONTENT)</code></pre>

        <p><strong>å±‚æ¬¡3ï¼šä½¿ç”¨GenericAPIView + Mixinsï¼ˆæ¨èï¼‰</strong></p>
        <pre><code>from rest_framework import generics, mixins
from .models import Book
from .serializers import BookSerializer

class BookListView(generics.GenericAPIView, 
                   mixins.ListModelMixin,      # æä¾›list()æ–¹æ³•
                   mixins.CreateModelMixin):   # æä¾›create()æ–¹æ³•
    """
    å›¾ä¹¦åˆ—è¡¨è§†å›¾
    GenericAPIViewæä¾›åŸºç¡€åŠŸèƒ½
    Mixinsæä¾›å…·ä½“çš„CRUDæ–¹æ³•
    """
    queryset = Book.objects.all()       # æŸ¥è¯¢é›†
    serializer_class = BookSerializer   # åºåˆ—åŒ–å™¨ç±»
    
    def get(self, request, *args, **kwargs):
        """GETè¯·æ±‚è°ƒç”¨list()æ–¹æ³•"""
        return self.list(request, *args, **kwargs)
    
    def post(self, request, *args, **kwargs):
        """POSTè¯·æ±‚è°ƒç”¨create()æ–¹æ³•"""
        return self.create(request, *args, **kwargs)


class BookDetailView(generics.GenericAPIView,
                     mixins.RetrieveModelMixin,  # æä¾›retrieve()æ–¹æ³•
                     mixins.UpdateModelMixin,    # æä¾›update()æ–¹æ³•
                     mixins.DestroyModelMixin):  # æä¾›destroy()æ–¹æ³•
    """å›¾ä¹¦è¯¦æƒ…è§†å›¾"""
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    def get(self, request, *args, **kwargs):
        """GETè¯·æ±‚è°ƒç”¨retrieve()æ–¹æ³•"""
        return self.retrieve(request, *args, **kwargs)
    
    def put(self, request, *args, **kwargs):
        """PUTè¯·æ±‚è°ƒç”¨update()æ–¹æ³•"""
        return self.update(request, *args, **kwargs)
    
    def delete(self, request, *args, **kwargs):
        """DELETEè¯·æ±‚è°ƒç”¨destroy()æ–¹æ³•"""
        return self.destroy(request, *args, **kwargs)</code></pre>

        <div class="note">
            <strong>ğŸ’¡ Mixinsè¯´æ˜ï¼š</strong>
            <ul>
                <li><strong>ListModelMixinï¼š</strong>æä¾›.list()æ–¹æ³•ï¼Œè¿”å›å¯¹è±¡åˆ—è¡¨</li>
                <li><strong>CreateModelMixinï¼š</strong>æä¾›.create()æ–¹æ³•ï¼Œåˆ›å»ºæ–°å¯¹è±¡</li>
                <li><strong>RetrieveModelMixinï¼š</strong>æä¾›.retrieve()æ–¹æ³•ï¼Œè¿”å›å•ä¸ªå¯¹è±¡</li>
                <li><strong>UpdateModelMixinï¼š</strong>æä¾›.update()å’Œ.partial_update()æ–¹æ³•ï¼Œæ›´æ–°å¯¹è±¡</li>
                <li><strong>DestroyModelMixinï¼š</strong>æä¾›.destroy()æ–¹æ³•ï¼Œåˆ é™¤å¯¹è±¡</li>
            </ul>
        </div>

        <p><strong>å±‚æ¬¡4ï¼šä½¿ç”¨é€šç”¨è§†å›¾ç±»ï¼ˆæœ€ç®€æ´ï¼‰</strong></p>
        <pre><code>from rest_framework import generics
from .models import Book
from .serializers import BookSerializer

# ListCreateAPIView = GenericAPIView + ListModelMixin + CreateModelMixin
class BookListView(generics.ListCreateAPIView):
    """
    å›¾ä¹¦åˆ—è¡¨è§†å›¾ - è¶…çº§ç®€æ´ï¼
    è‡ªåŠ¨å¤„ç†GETï¼ˆåˆ—è¡¨ï¼‰å’ŒPOSTï¼ˆåˆ›å»ºï¼‰
    """
    queryset = Book.objects.all()
    serializer_class = BookSerializer


# RetrieveUpdateDestroyAPIView = GenericAPIView + RetrieveModelMixin + UpdateModelMixin + DestroyModelMixin
class BookDetailView(generics.RetrieveUpdateDestroyAPIView):
    """
    å›¾ä¹¦è¯¦æƒ…è§†å›¾ - è¶…çº§ç®€æ´ï¼
    è‡ªåŠ¨å¤„ç†GETï¼ˆè¯¦æƒ…ï¼‰ã€PUTï¼ˆæ›´æ–°ï¼‰ã€DELETEï¼ˆåˆ é™¤ï¼‰
    """
    queryset = Book.objects.all()
    serializer_class = BookSerializer</code></pre>

        <div class="success">
            <strong>âœ… å¸¸ç”¨é€šç”¨è§†å›¾ç±»ï¼š</strong>
            <ul>
                <li><strong>ListAPIViewï¼š</strong>åªè¯»åˆ—è¡¨</li>
                <li><strong>CreateAPIViewï¼š</strong>åªåˆ›å»º</li>
                <li><strong>RetrieveAPIViewï¼š</strong>åªè¯»è¯¦æƒ…</li>
                <li><strong>UpdateAPIViewï¼š</strong>åªæ›´æ–°</li>
                <li><strong>DestroyAPIViewï¼š</strong>åªåˆ é™¤</li>
                <li><strong>ListCreateAPIViewï¼š</strong>åˆ—è¡¨+åˆ›å»º</li>
                <li><strong>RetrieveUpdateAPIViewï¼š</strong>è¯¦æƒ…+æ›´æ–°</li>
                <li><strong>RetrieveDestroyAPIViewï¼š</strong>è¯¦æƒ…+åˆ é™¤</li>
                <li><strong>RetrieveUpdateDestroyAPIViewï¼š</strong>è¯¦æƒ…+æ›´æ–°+åˆ é™¤</li>
            </ul>
        </div>

        <h4>3.2.2 è§†å›¾ä¸­çš„å¸¸ç”¨æ–¹æ³•é‡å†™</h4>
        
        <pre><code>from rest_framework import generics
from rest_framework.response import Response
from .models import Book
from .serializers import BookSerializer

class BookListView(generics.ListCreateAPIView):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    def get_queryset(self):
        """
        é‡å†™get_querysetæ–¹æ³•
        å¯ä»¥åŠ¨æ€è¿‡æ»¤queryset
        """
        queryset = super().get_queryset()
        
        # æ ¹æ®è¯·æ±‚å‚æ•°è¿‡æ»¤
        author = self.request.query_params.get('author')
        if author:
            queryset = queryset.filter(author=author)
        
        # åªè¿”å›å·²å‘å¸ƒçš„å›¾ä¹¦
        queryset = queryset.filter(status='published')
        
        return queryset
    
    def get_serializer_class(self):
        """
        é‡å†™get_serializer_classæ–¹æ³•
        å¯ä»¥æ ¹æ®ä¸åŒæƒ…å†µä½¿ç”¨ä¸åŒçš„åºåˆ—åŒ–å™¨
        """
        if self.request.user.is_staff:
            return AdminBookSerializer  # ç®¡ç†å‘˜çœ‹åˆ°æ›´å¤šå­—æ®µ
        return BookSerializer  # æ™®é€šç”¨æˆ·çœ‹åˆ°åŸºæœ¬å­—æ®µ
    
    def perform_create(self, serializer):
        """
        é‡å†™perform_createæ–¹æ³•
        åœ¨ä¿å­˜å‰å¯ä»¥æ·»åŠ é¢å¤–é€»è¾‘
        """
        # è‡ªåŠ¨è®¾ç½®å½“å‰ç”¨æˆ·ä¸ºä½œè€…
        serializer.save(created_by=self.request.user)
    
    def list(self, request, *args, **kwargs):
        """
        é‡å†™listæ–¹æ³•
        å®Œå…¨è‡ªå®šä¹‰åˆ—è¡¨å“åº”
        """
        queryset = self.get_queryset()
        serializer = self.get_serializer(queryset, many=True)
        
        # è‡ªå®šä¹‰å“åº”æ ¼å¼
        return Response({
            'code': 0,
            'message': 'è·å–æˆåŠŸ',
            'count': queryset.count(),
            'data': serializer.data
        })</code></pre>

        <h3 id="viewsets">3.3 è§†å›¾é›†ï¼ˆViewSetsï¼‰è¯¦è§£</h3>
        
        <div class="concept-box">
            <h4>ğŸš€ ä»€ä¹ˆæ˜¯ViewSetï¼Ÿ</h4>
            <p><strong>ViewSetï¼ˆè§†å›¾é›†ï¼‰</strong>æ˜¯DRFçš„é«˜çº§ç‰¹æ€§ï¼Œå°†ç›¸å…³çš„è§†å›¾é€»è¾‘ç»„åˆåˆ°ä¸€ä¸ªç±»ä¸­ã€‚</p>
            <p><strong>ä¼˜åŠ¿ï¼š</strong></p>
            <ul>
                <li>ä¸€ä¸ªç±»å¤„ç†ä¸€ä¸ªèµ„æºçš„æ‰€æœ‰æ“ä½œï¼ˆåˆ—è¡¨ã€è¯¦æƒ…ã€åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ï¼‰</li>
                <li>ä»£ç æ›´ç®€æ´ï¼Œå‡å°‘é‡å¤</li>
                <li>é…åˆRouterè‡ªåŠ¨ç”ŸæˆURL</li>
            </ul>
        </div>

        <h4>3.3.1 ViewSetçš„ç±»å‹</h4>
        
        <pre><code>from rest_framework import viewsets
from .models import Book
from .serializers import BookSerializer

# 1. ViewSet - æœ€åŸºç¡€çš„ï¼Œéœ€è¦è‡ªå·±å®ç°æ‰€æœ‰æ–¹æ³•
class BookViewSet(viewsets.ViewSet):
    """
    åŸºç¡€ViewSet
    éœ€è¦æ‰‹åŠ¨å®ç°listã€createã€retrieveã€updateã€destroyæ–¹æ³•
    """
    def list(self, request):
        """GET /books/ - åˆ—è¡¨"""
        books = Book.objects.all()
        serializer = BookSerializer(books, many=True)
        return Response(serializer.data)
    
    def create(self, request):
        """POST /books/ - åˆ›å»º"""
        serializer = BookSerializer(data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
    
    def retrieve(self, request, pk=None):
        """GET /books/1/ - è¯¦æƒ…"""
        book = Book.objects.get(pk=pk)
        serializer = BookSerializer(book)
        return Response(serializer.data)
    
    def update(self, request, pk=None):
        """PUT /books/1/ - æ›´æ–°"""
        book = Book.objects.get(pk=pk)
        serializer = BookSerializer(book, data=request.data)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)
    
    def destroy(self, request, pk=None):
        """DELETE /books/1/ - åˆ é™¤"""
        book = Book.objects.get(pk=pk)
        book.delete()
        return Response(status=status.HTTP_204_NO_CONTENT)


# 2. ModelViewSet - æœ€å¸¸ç”¨ï¼Œè‡ªåŠ¨æä¾›æ‰€æœ‰CRUDæ“ä½œï¼ˆæ¨èï¼‰
class BookViewSet(viewsets.ModelViewSet):
    """
    æ¨¡å‹ViewSet - åªéœ€ä¸‰è¡Œä»£ç ï¼
    è‡ªåŠ¨æä¾›ï¼šlistã€createã€retrieveã€updateã€partial_updateã€destroy
    """
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    # å®Œæˆï¼æ‰€æœ‰CRUDæ“ä½œéƒ½è‡ªåŠ¨å®ç°äº†


# 3. ReadOnlyModelViewSet - åªè¯»ViewSet
class BookViewSet(viewsets.ReadOnlyModelViewSet):
    """
    åªè¯»ViewSet
    åªæä¾›listå’Œretrieveæ–¹æ³•ï¼Œä¸èƒ½åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤
    """
    queryset = Book.objects.all()
    serializer_class = BookSerializer</code></pre>

        <div class="example-section">
            <h4>ğŸ¯ ModelViewSetè‡ªåŠ¨æä¾›çš„æ“ä½œï¼š</h4>
            <table>
                <tr>
                    <th>æ–¹æ³•å</th>
                    <th>HTTPæ–¹æ³•</th>
                    <th>URL</th>
                    <th>ä½œç”¨</th>
                </tr>
                <tr>
                    <td>list</td>
                    <td>GET</td>
                    <td>/books/</td>
                    <td>è·å–åˆ—è¡¨</td>
                </tr>
                <tr>
                    <td>create</td>
                    <td>POST</td>
                    <td>/books/</td>
                    <td>åˆ›å»ºæ–°å¯¹è±¡</td>
                </tr>
                <tr>
                    <td>retrieve</td>
                    <td>GET</td>
                    <td>/books/{id}/</td>
                    <td>è·å–è¯¦æƒ…</td>
                </tr>
                <tr>
                    <td>update</td>
                    <td>PUT</td>
                    <td>/books/{id}/</td>
                    <td>å®Œæ•´æ›´æ–°</td>
                </tr>
                <tr>
                    <td>partial_update</td>
                    <td>PATCH</td>
                    <td>/books/{id}/</td>
                    <td>éƒ¨åˆ†æ›´æ–°</td>
                </tr>
                <tr>
                    <td>destroy</td>
                    <td>DELETE</td>
                    <td>/books/{id}/</td>
                    <td>åˆ é™¤</td>
                </tr>
            </table>
        </div>

        <h4>3.3.2 è‡ªå®šä¹‰ViewSetæ–¹æ³•</h4>
        
        <pre><code>from rest_framework import viewsets
from rest_framework.decorators import action
from rest_framework.response import Response
from .models import Book
from .serializers import BookSerializer

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    # æ·»åŠ è‡ªå®šä¹‰æ“ä½œï¼ˆdetail=Falseè¡¨ç¤ºä½œç”¨äºåˆ—è¡¨ï¼‰
    @action(detail=False, methods=['get'])
    def recent(self, request):
        """
        GET /books/recent/ - è·å–æœ€è¿‘çš„å›¾ä¹¦
        detail=Falseï¼šURLä¸º /books/recent/
        """
        recent_books = Book.objects.order_by('-created_at')[:10]
        serializer = self.get_serializer(recent_books, many=True)
        return Response(serializer.data)
    
    # ä½œç”¨äºå•ä¸ªå¯¹è±¡çš„è‡ªå®šä¹‰æ“ä½œï¼ˆdetail=Trueï¼‰
    @action(detail=True, methods=['post'])
    def borrow(self, request, pk=None):
        """
        POST /books/1/borrow/ - å€Ÿé˜…å›¾ä¹¦
        detail=Trueï¼šURLä¸º /books/{id}/borrow/
        """
        book = self.get_object()
        book.is_borrowed = True
        book.borrowed_by = request.user
        book.save()
        return Response({'status': 'å€Ÿé˜…æˆåŠŸ'})
    
    # æ”¯æŒå¤šç§HTTPæ–¹æ³•
    @action(detail=True, methods=['get', 'post'])
    def reviews(self, request, pk=None):
        """
        GET /books/1/reviews/ - è·å–è¯„è®º
        POST /books/1/reviews/ - æ·»åŠ è¯„è®º
        """
        book = self.get_object()
        
        if request.method == 'GET':
            reviews = book.reviews.all()
            # è¿™é‡Œå¯ä»¥ç”¨å¦ä¸€ä¸ªåºåˆ—åŒ–å™¨
            return Response({'reviews': reviews.count()})
        
        elif request.method == 'POST':
            # æ·»åŠ è¯„è®ºé€»è¾‘
            return Response({'status': 'è¯„è®ºæˆåŠŸ'})
    
    def perform_create(self, serializer):
        """
        åˆ›å»ºæ—¶çš„é’©å­æ–¹æ³•
        """
        # è‡ªåŠ¨è®¾ç½®åˆ›å»ºè€…
        serializer.save(created_by=self.request.user)
    
    def perform_update(self, serializer):
        """
        æ›´æ–°æ—¶çš„é’©å­æ–¹æ³•
        """
        # è‡ªåŠ¨æ›´æ–°ä¿®æ”¹è€…
        serializer.save(updated_by=self.request.user)
    
    def perform_destroy(self, instance):
        """
        åˆ é™¤æ—¶çš„é’©å­æ–¹æ³•
        """
        # å¯ä»¥å®ç°è½¯åˆ é™¤
        instance.is_deleted = True
        instance.save()
        # æˆ–è€…çœŸåˆ é™¤ï¼š
        # instance.delete()</code></pre>

        <h3 id="routers">3.4 è·¯ç”±å™¨ï¼ˆRoutersï¼‰ä½¿ç”¨</h3>
        
        <div class="concept-box">
            <h4>ğŸ—ºï¸ ä»€ä¹ˆæ˜¯Routerï¼Ÿ</h4>
            <p><strong>Routerï¼ˆè·¯ç”±å™¨ï¼‰</strong>è‡ªåŠ¨ä¸ºViewSetç”ŸæˆURLé…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™urlpatternsã€‚</p>
        </div>

        <h4>3.4.1 åŸºç¡€ä½¿ç”¨</h4>
        
        <pre><code># urls.py
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import BookViewSet

# åˆ›å»ºè·¯ç”±å™¨å®ä¾‹
router = DefaultRouter()

# æ³¨å†ŒViewSet
# ç¬¬ä¸€ä¸ªå‚æ•°ï¼šURLå‰ç¼€
# ç¬¬äºŒä¸ªå‚æ•°ï¼šViewSetç±»
# basenameï¼šURLåç§°çš„å‰ç¼€ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨æ¨¡å‹åå°å†™ï¼‰
router.register(r'books', BookViewSet, basename='book')

# ç”ŸæˆURLé…ç½®
urlpatterns = [
    path('', include(router.urls)),
]

# Routerè‡ªåŠ¨ç”Ÿæˆçš„URLï¼š
# GET    /books/          -> list()          (åˆ—è¡¨)
# POST   /books/          -> create()        (åˆ›å»º)
# GET    /books/{id}/     -> retrieve()      (è¯¦æƒ…)
# PUT    /books/{id}/     -> update()        (æ›´æ–°)
# PATCH  /books/{id}/     -> partial_update()(éƒ¨åˆ†æ›´æ–°)
# DELETE /books/{id}/     -> destroy()       (åˆ é™¤)
# 
# å¦‚æœæœ‰è‡ªå®šä¹‰actionï¼š
# GET    /books/recent/       -> recent()
# POST   /books/{id}/borrow/  -> borrow()</code></pre>

        <div class="example-section">
            <h4>ğŸ“‹ å®Œæ•´çš„urls.pyç¤ºä¾‹</h4>
            <pre><code># config/urls.py (ä¸»URLé…ç½®)
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/', include('api.urls')),  # åŒ…å«åº”ç”¨çš„URL
]


# api/urls.py (åº”ç”¨URLé…ç½®)
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import BookViewSet, AuthorViewSet, CategoryViewSet

# åˆ›å»ºè·¯ç”±å™¨
router = DefaultRouter()

# æ³¨å†Œå¤šä¸ªViewSet
router.register(r'books', BookViewSet)
router.register(r'authors', AuthorViewSet)
router.register(r'categories', CategoryViewSet)

urlpatterns = [
    # åŒ…å«routerç”Ÿæˆçš„URL
    path('', include(router.urls)),
    
    # å¦‚æœæœ‰å…¶ä»–éViewSetçš„è§†å›¾ï¼Œæ‰‹åŠ¨æ·»åŠ 
    # path('custom/', CustomView.as_view(), name='custom'),
]</code></pre>
        </div>

        <h4>3.4.2 SimpleRouter vs DefaultRouter</h4>
        
        <table>
            <tr>
                <th>ç‰¹æ€§</th>
                <th>SimpleRouter</th>
                <th>DefaultRouter</th>
            </tr>
            <tr>
                <td>ç”Ÿæˆæ ‡å‡†REST URL</td>
                <td>âœ…</td>
                <td>âœ…</td>
            </tr>
            <tr>
                <td>ç”ŸæˆAPIæ ¹è§†å›¾</td>
                <td>âŒ</td>
                <td>âœ… (å¯ç‚¹å‡»æŸ¥çœ‹æ‰€æœ‰API)</td>
            </tr>
            <tr>
                <td>URLæ ¼å¼</td>
                <td>/books/1</td>
                <td>/books/1/ (å¸¦å°¾éšæ–œæ )</td>
            </tr>
            <tr>
                <td>æ¨èä½¿ç”¨</td>
                <td>APIå†…éƒ¨è°ƒç”¨</td>
                <td>å¼€å‘å’Œæµè§ˆå™¨è®¿é—®</td>
            </tr>
        </table>

        <pre><code># ä½¿ç”¨SimpleRouter
from rest_framework.routers import SimpleRouter
router = SimpleRouter()

# ä½¿ç”¨DefaultRouterï¼ˆæ¨èï¼‰
from rest_framework.routers import DefaultRouter
router = DefaultRouter()</code></pre>

        <h3 id="authentication">3.5 è®¤è¯ï¼ˆAuthenticationï¼‰æœºåˆ¶</h3>
        
        <div class="concept-box">
            <h4>ğŸ” ä»€ä¹ˆæ˜¯è®¤è¯ï¼Ÿ</h4>
            <p><strong>è®¤è¯ï¼ˆAuthenticationï¼‰</strong>æ˜¯éªŒè¯"ä½ æ˜¯è°"çš„è¿‡ç¨‹ã€‚DRFæä¾›å¤šç§è®¤è¯æ–¹å¼ã€‚</p>
        </div>

        <h4>3.5.1 DRFå†…ç½®è®¤è¯ç±»</h4>
        
        <table>
            <tr>
                <th>è®¤è¯ç±»</th>
                <th>è¯´æ˜</th>
                <th>ä½¿ç”¨åœºæ™¯</th>
            </tr>
            <tr>
                <td>BasicAuthentication</td>
                <td>HTTPåŸºæœ¬è®¤è¯ï¼ˆç”¨æˆ·å+å¯†ç ï¼‰</td>
                <td>æµ‹è¯•ç¯å¢ƒã€ç®€å•API</td>
            </tr>
            <tr>
                <td>SessionAuthentication</td>
                <td>åŸºäºDjango Session</td>
                <td>Webæµè§ˆå™¨è®¿é—®</td>
            </tr>
            <tr>
                <td>TokenAuthentication</td>
                <td>åŸºäºTokenä»¤ç‰Œ</td>
                <td>ç§»åŠ¨ç«¯ã€ç®€å•API</td>
            </tr>
            <tr>
                <td>JWTAuthentication</td>
                <td>åŸºäºJWTï¼ˆéœ€è¦å®‰è£…simplejwtï¼‰</td>
                <td>ç°ä»£Webåº”ç”¨ï¼ˆæ¨èï¼‰</td>
            </tr>
        </table>

        <h4>3.5.2 å…¨å±€è®¤è¯é…ç½®</h4>
        
        <pre><code># settings.py
REST_FRAMEWORK = {
    # é»˜è®¤è®¤è¯ç±»ï¼ˆå…¨å±€é…ç½®ï¼‰
    'DEFAULT_AUTHENTICATION_CLASSES': [
        # JWTè®¤è¯ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰
        'rest_framework_simplejwt.authentication.JWTAuthentication',
        # Sessionè®¤è¯ï¼ˆç”¨äºæµè§ˆå™¨è®¿é—®ï¼‰
        'rest_framework.authentication.SessionAuthentication',
        # Basicè®¤è¯ï¼ˆç”¨äºæµ‹è¯•ï¼‰
        'rest_framework.authentication.BasicAuthentication',
    ],
}</code></pre>

        <h4>3.5.3 è§†å›¾çº§åˆ«è®¤è¯é…ç½®</h4>
        
        <pre><code>from rest_framework.authentication import SessionAuthentication, BasicAuthentication
from rest_framework.permissions import IsAuthenticated
from rest_framework import viewsets

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    # ä¸ºè¿™ä¸ªè§†å›¾æŒ‡å®šè®¤è¯æ–¹å¼ï¼ˆè¦†ç›–å…¨å±€é…ç½®ï¼‰
    authentication_classes = [SessionAuthentication, BasicAuthentication]
    # è¦æ±‚å¿…é¡»è®¤è¯
    permission_classes = [IsAuthenticated]


# ä¹Ÿå¯ä»¥ä½¿ç”¨è£…é¥°å™¨ï¼ˆç”¨äºå‡½æ•°è§†å›¾ï¼‰
from rest_framework.decorators import api_view, authentication_classes, permission_classes
from rest_framework.authentication import TokenAuthentication

@api_view(['GET'])
@authentication_classes([TokenAuthentication])
@permission_classes([IsAuthenticated])
def my_view(request):
    return Response({'message': 'éœ€è¦Tokenè®¤è¯æ‰èƒ½è®¿é—®'})</code></pre>

        <h4>3.5.4 Tokenè®¤è¯ç¤ºä¾‹</h4>
        
        <pre><code># 1. åœ¨settings.pyçš„INSTALLED_APPSä¸­æ·»åŠ 
INSTALLED_APPS = [
    # ...
    'rest_framework.authtoken',  # Tokenè®¤è¯
]

# 2. æ‰§è¡Œè¿ç§»åˆ›å»ºTokenè¡¨
python manage.py migrate

# 3. åˆ›å»ºè§†å›¾ç”ŸæˆToken
from rest_framework.authtoken.models import Token
from rest_framework.response import Response
from rest_framework.decorators import api_view
from django.contrib.auth import authenticate

@api_view(['POST'])
def login(request):
    """
    ç”¨æˆ·ç™»å½•ï¼Œè¿”å›Token
    POST /api/login/
    {
        "username": "user1",
        "password": "password123"
    }
    """
    username = request.data.get('username')
    password = request.data.get('password')
    
    # éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
    user = authenticate(username=username, password=password)
    
    if user:
        # è·å–æˆ–åˆ›å»ºToken
        token, created = Token.objects.get_or_create(user=user)
        return Response({
            'token': token.key,
            'user_id': user.id,
            'username': user.username
        })
    else:
        return Response(
            {'error': 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'}, 
            status=status.HTTP_400_BAD_REQUEST
        )

# 4. å®¢æˆ·ç«¯ä½¿ç”¨Tokenè®¿é—®API
# åœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š
# Authorization: Token 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b</code></pre>

        <h3 id="permissions">3.6 æƒé™ï¼ˆPermissionsï¼‰æ§åˆ¶</h3>
        
        <div class="concept-box">
            <h4>ğŸ›¡ï¸ ä»€ä¹ˆæ˜¯æƒé™ï¼Ÿ</h4>
            <p><strong>æƒé™ï¼ˆPermissionï¼‰</strong>æ˜¯éªŒè¯"ä½ èƒ½åšä»€ä¹ˆ"çš„è¿‡ç¨‹ã€‚è®¤è¯è§£å†³èº«ä»½é—®é¢˜ï¼Œæƒé™è§£å†³æˆæƒé—®é¢˜ã€‚</p>
        </div>

        <h4>3.6.1 DRFå†…ç½®æƒé™ç±»</h4>
        
        <table>
            <tr>
                <th>æƒé™ç±»</th>
                <th>è¯´æ˜</th>
            </tr>
            <tr>
                <td>AllowAny</td>
                <td>å…è®¸ä»»ä½•äººï¼ˆæ— éœ€è®¤è¯ï¼‰</td>
            </tr>
            <tr>
                <td>IsAuthenticated</td>
                <td>åªå…è®¸å·²è®¤è¯ç”¨æˆ·</td>
            </tr>
            <tr>
                <td>IsAdminUser</td>
                <td>åªå…è®¸ç®¡ç†å‘˜ï¼ˆis_staff=Trueï¼‰</td>
            </tr>
            <tr>
                <td>IsAuthenticatedOrReadOnly</td>
                <td>è®¤è¯ç”¨æˆ·å¯è¯»å†™ï¼Œæœªè®¤è¯ç”¨æˆ·åªè¯»</td>
            </tr>
        </table>

        <h4>3.6.2 æƒé™é…ç½®</h4>
        
        <pre><code># settings.py - å…¨å±€é…ç½®
REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',  # é»˜è®¤éœ€è¦è®¤è¯
    ],
}


# views.py - è§†å›¾çº§åˆ«é…ç½®
from rest_framework.permissions import IsAuthenticated, AllowAny
from rest_framework import viewsets

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    # ä¸ºä¸åŒçš„æ“ä½œè®¾ç½®ä¸åŒçš„æƒé™
    def get_permissions(self):
        """
        æ ¹æ®ä¸åŒçš„actionè¿”å›ä¸åŒçš„æƒé™
        """
        if self.action in ['list', 'retrieve']:
            # åˆ—è¡¨å’Œè¯¦æƒ…ï¼šä»»ä½•äººéƒ½å¯ä»¥è®¿é—®
            permission_classes = [AllowAny]
        elif self.action == 'create':
            # åˆ›å»ºï¼šéœ€è¦è®¤è¯
            permission_classes = [IsAuthenticated]
        else:
            # æ›´æ–°å’Œåˆ é™¤ï¼šéœ€è¦æ˜¯ç®¡ç†å‘˜
            permission_classes = [IsAdminUser]
        return [permission() for permission in permission_classes]</code></pre>

        <h4>3.6.3 è‡ªå®šä¹‰æƒé™ç±»</h4>
        
        <pre><code># permissions.py
from rest_framework import permissions

class IsOwnerOrReadOnly(permissions.BasePermission):
    """
    è‡ªå®šä¹‰æƒé™ï¼šåªæœ‰å¯¹è±¡çš„æ‰€æœ‰è€…æ‰èƒ½ç¼–è¾‘
    å…¶ä»–äººåªèƒ½æŸ¥çœ‹
    """
    
    def has_permission(self, request, view):
        """
        å¯¹è±¡çº§åˆ«ä¹‹å‰çš„æƒé™æ£€æŸ¥
        request: è¯·æ±‚å¯¹è±¡
        view: è§†å›¾å¯¹è±¡
        """
        # æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®ï¼ˆæŸ¥çœ‹ï¼‰
        if request.method in permissions.SAFE_METHODS:  # GET, HEAD, OPTIONS
            return True
        
        # å…¶ä»–æ“ä½œéœ€è¦è®¤è¯
        return request.user and request.user.is_authenticated
    
    def has_object_permission(self, request, view, obj):
        """
        å¯¹è±¡çº§åˆ«çš„æƒé™æ£€æŸ¥
        obj: å½“å‰æ“ä½œçš„å¯¹è±¡
        """
        # è¯»æ“ä½œå…è®¸æ‰€æœ‰äºº
        if request.method in permissions.SAFE_METHODS:
            return True
        
        # å†™æ“ä½œåªå…è®¸æ‰€æœ‰è€…
        return obj.author == request.user


# åœ¨è§†å›¾ä¸­ä½¿ç”¨è‡ªå®šä¹‰æƒé™
from .permissions import IsOwnerOrReadOnly

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    permission_classes = [IsOwnerOrReadOnly]  # ä½¿ç”¨è‡ªå®šä¹‰æƒé™</code></pre>

        <div class="example-section">
            <h4>ğŸ”’ æƒé™æ£€æŸ¥æµç¨‹</h4>
            <ol>
                <li><strong>è®¤è¯ï¼š</strong>è¯†åˆ«ç”¨æˆ·èº«ä»½ï¼ˆé€šè¿‡Tokenã€Sessionç­‰ï¼‰</li>
                <li><strong>has_permission()ï¼š</strong>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®è§†å›¾çš„æƒé™</li>
                <li><strong>has_object_permission()ï¼š</strong>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æ“ä½œç‰¹å®šå¯¹è±¡çš„æƒé™</li>
            </ol>
        </div>

        <h3 id="filtering">3.7 è¿‡æ»¤ã€æœç´¢å’Œæ’åº</h3>
        
        <h4>3.7.1 åŸºç¡€è¿‡æ»¤</h4>
        
        <pre><code># æ–¹æ³•1ï¼šé‡å†™get_queryset()
class BookViewSet(viewsets.ModelViewSet):
    serializer_class = BookSerializer
    
    def get_queryset(self):
        """
        æ ¹æ®URLå‚æ•°è¿‡æ»¤
        GET /books/?author=å¼ ä¸‰&status=published
        """
        queryset = Book.objects.all()
        
        # è·å–URLå‚æ•°
        author = self.request.query_params.get('author')
        status = self.request.query_params.get('status')
        
        # è¿‡æ»¤
        if author:
            queryset = queryset.filter(author=author)
        if status:
            queryset = queryset.filter(status=status)
        
        return queryset</code></pre>

        <h4>3.7.2 ä½¿ç”¨django-filter</h4>
        
        <pre><code># 1. å®‰è£…
pip install django-filter

# 2. åœ¨settings.pyä¸­é…ç½®
INSTALLED_APPS = [
    # ...
    'django_filters',
]

REST_FRAMEWORK = {
    'DEFAULT_FILTER_BACKENDS': [
        'django_filters.rest_framework.DjangoFilterBackend',
        'rest_framework.filters.SearchFilter',
        'rest_framework.filters.OrderingFilter',
    ],
}


# 3. åœ¨è§†å›¾ä¸­ä½¿ç”¨
class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    # ç®€å•è¿‡æ»¤ï¼šæŒ‡å®šå¯è¿‡æ»¤çš„å­—æ®µ
    filterset_fields = ['author', 'status', 'category']
    # GET /books/?author=å¼ ä¸‰&status=published


# 4. é«˜çº§è¿‡æ»¤ï¼šè‡ªå®šä¹‰è¿‡æ»¤å™¨
from django_filters import rest_framework as filters

class BookFilter(filters.FilterSet):
    """è‡ªå®šä¹‰è¿‡æ»¤å™¨"""
    # æ¨¡ç³ŠæŸ¥è¯¢
    title = filters.CharFilter(lookup_expr='icontains')
    
    # èŒƒå›´æŸ¥è¯¢
    min_price = filters.NumberFilter(field_name='price', lookup_expr='gte')
    max_price = filters.NumberFilter(field_name='price', lookup_expr='lte')
    
    # æ—¥æœŸèŒƒå›´
    published_after = filters.DateFilter(field_name='published_date', lookup_expr='gte')
    published_before = filters.DateFilter(field_name='published_date', lookup_expr='lte')
    
    class Meta:
        model = Book
        fields = ['title', 'author', 'status']

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    filterset_class = BookFilter
    # GET /books/?title=Python&min_price=50&max_price=200</code></pre>

        <h4>3.7.3 æœç´¢åŠŸèƒ½</h4>
        
        <pre><code>from rest_framework import filters

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    filter_backends = [filters.SearchFilter]
    
    # æŒ‡å®šå¯æœç´¢çš„å­—æ®µ
    search_fields = ['title', 'author', 'description']
    # GET /books/?search=Python
    # ä¼šåœ¨titleã€authorã€descriptionä¸­æœç´¢åŒ…å«"Python"çš„è®°å½•
    
    # ç²¾ç¡®åŒ¹é…ï¼šåœ¨å­—æ®µå‰åŠ  =
    # search_fields = ['=username']
    
    # æ­£åˆ™æœç´¢ï¼šåœ¨å­—æ®µå‰åŠ  $
    # search_fields = ['$title']
    
    # å¤–é”®å­—æ®µæœç´¢ï¼šä½¿ç”¨åŒä¸‹åˆ’çº¿
    # search_fields = ['category__name', 'author__email']</code></pre>

        <h4>3.7.4 æ’åºåŠŸèƒ½</h4>
        
        <pre><code>from rest_framework import filters

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    filter_backends = [filters.OrderingFilter]
    
    # æŒ‡å®šå¯æ’åºçš„å­—æ®µ
    ordering_fields = ['price', 'published_date', 'title']
    # GET /books/?ordering=price          (ä»·æ ¼å‡åº)
    # GET /books/?ordering=-price         (ä»·æ ¼é™åº)
    # GET /books/?ordering=price,-published_date  (å¤šå­—æ®µæ’åº)
    
    # é»˜è®¤æ’åº
    ordering = ['-created_at']</code></pre>

        <h4>3.7.5 ç»„åˆä½¿ç”¨</h4>
        
        <pre><code>class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    
    # å¯ç”¨å¤šä¸ªåç«¯
    filter_backends = [
        filters.SearchFilter,
        filters.OrderingFilter,
        DjangoFilterBackend,
    ]
    
    # è¿‡æ»¤
    filterset_fields = ['author', 'status', 'category']
    
    # æœç´¢
    search_fields = ['title', 'description']
    
    # æ’åº
    ordering_fields = ['price', 'published_date']
    ordering = ['-created_at']

# ç»¼åˆä½¿ç”¨ç¤ºä¾‹ï¼š
# GET /books/?author=å¼ ä¸‰&search=Python&ordering=-price
# æ„æ€æ˜¯ï¼šæŸ¥æ‰¾ä½œè€…ä¸º"å¼ ä¸‰"ã€æ ‡é¢˜æˆ–æè¿°åŒ…å«"Python"çš„ä¹¦ï¼ŒæŒ‰ä»·æ ¼é™åºæ’åˆ—</code></pre>

        <h3 id="pagination">3.8 åˆ†é¡µï¼ˆPaginationï¼‰</h3>
        
        <div class="concept-box">
            <h4>ğŸ“„ ä¸ºä»€ä¹ˆéœ€è¦åˆ†é¡µï¼Ÿ</h4>
            <p>å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰æ•°æ®ä¼šï¼š</p>
            <ul>
                <li>æ¶ˆè€—å¤§é‡å†…å­˜å’Œå¸¦å®½</li>
                <li>å¯¼è‡´å“åº”å˜æ…¢</li>
                <li>å‰ç«¯æ¸²æŸ“å›°éš¾</li>
            </ul>
            <p>åˆ†é¡µå¯ä»¥å°†æ•°æ®åˆ†æˆå¤šä¸ªå°å—ï¼ŒæŒ‰éœ€è·å–ã€‚</p>
        </div>

        <h4>3.8.1 DRFå†…ç½®åˆ†é¡µç±»</h4>
        
        <p><strong>1. PageNumberPaginationï¼ˆé¡µç åˆ†é¡µï¼‰</strong></p>
        <pre><code># settings.py - å…¨å±€é…ç½®
REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10  # æ¯é¡µ10æ¡æ•°æ®
}

# ä½¿ç”¨ï¼š
# GET /books/?page=1  (ç¬¬1é¡µ)
# GET /books/?page=2  (ç¬¬2é¡µ)

# å“åº”æ ¼å¼ï¼š
{
    "count": 100,          # æ€»è®°å½•æ•°
    "next": "http://api.example.com/books/?page=2",    # ä¸‹ä¸€é¡µURL
    "previous": null,      # ä¸Šä¸€é¡µURL
    "results": [...]       # å½“å‰é¡µæ•°æ®
}</code></pre>

        <p><strong>2. LimitOffsetPaginationï¼ˆåç§»åˆ†é¡µï¼‰</strong></p>
        <pre><code># settings.py
REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.LimitOffsetPagination',
    'PAGE_SIZE': 10
}

# ä½¿ç”¨ï¼š
# GET /books/?limit=10&offset=0   (è·³è¿‡0æ¡ï¼Œå–10æ¡)
# GET /books/?limit=10&offset=10  (è·³è¿‡10æ¡ï¼Œå–10æ¡)

# å“åº”æ ¼å¼ï¼š
{
    "count": 100,
    "next": "http://api.example.com/books/?limit=10&offset=20",
    "previous": "http://api.example.com/books/?limit=10&offset=0",
    "results": [...]
}</code></pre>

        <p><strong>3. CursorPaginationï¼ˆæ¸¸æ ‡åˆ†é¡µï¼‰</strong></p>
        <pre><code># é€‚ç”¨äºå¤§æ•°æ®é›†ï¼Œæ€§èƒ½æœ€å¥½
REST_FRAMEWORK = {
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.CursorPagination',
    'PAGE_SIZE': 10
}

# ä½¿ç”¨ï¼š
# GET /books/?cursor=cD0yMDI0LTA
# ä½¿ç”¨ï¼š
# GET /books/?cursor=cD0yMDI0LTAxLTAxJTIwMTI6MDA6MDA=

# ç‰¹ç‚¹ï¼š
# - åªèƒ½å‰è¿›/åé€€ï¼Œä¸èƒ½è·³è½¬åˆ°æŒ‡å®šé¡µ
# - é€‚åˆå®æ—¶æ•°æ®æµï¼ˆå¦‚ç¤¾äº¤åª’ä½“æ—¶é—´çº¿ï¼‰
# - æ€§èƒ½æœ€å¥½</code></pre>

        <h4>3.8.2 è‡ªå®šä¹‰åˆ†é¡µç±»</h4>
        
        <pre><code># pagination.py
from rest_framework.pagination import PageNumberPagination
from rest_framework.response import Response

class CustomPagination(PageNumberPagination):
    """
    è‡ªå®šä¹‰åˆ†é¡µç±»
    """
    page_size = 10  # é»˜è®¤æ¯é¡µæ•°é‡
    page_size_query_param = 'page_size'  # å…è®¸å®¢æˆ·ç«¯æŒ‡å®šæ¯é¡µæ•°é‡
    max_page_size = 100  # æœ€å¤§æ¯é¡µæ•°é‡
    page_query_param = 'page'  # é¡µç å‚æ•°å
    
    def get_paginated_response(self, data):
        """
        è‡ªå®šä¹‰å“åº”æ ¼å¼
        """
        return Response({
            'code': 0,
            'message': 'è·å–æˆåŠŸ',
            'total': self.page.paginator.count,  # æ€»æ•°
            'page': self.page.number,  # å½“å‰é¡µç 
            'page_size': self.page.paginator.per_page,  # æ¯é¡µæ•°é‡
            'total_pages': self.page.paginator.num_pages,  # æ€»é¡µæ•°
            'has_next': self.page.has_next(),  # æ˜¯å¦æœ‰ä¸‹ä¸€é¡µ
            'has_previous': self.page.has_previous(),  # æ˜¯å¦æœ‰ä¸Šä¸€é¡µ
            'data': data
        })


# views.py - åœ¨è§†å›¾ä¸­ä½¿ç”¨
from .pagination import CustomPagination

class BookViewSet(viewsets.ModelViewSet):
    queryset = Book.objects.all()
    serializer_class = BookSerializer
    pagination_class = CustomPagination  # æŒ‡å®šåˆ†é¡µç±»

# å®¢æˆ·ç«¯è¯·æ±‚ï¼š
# GET /books/?page=1&page_size=20</code></pre>

        <!-- ==================== ç¬¬å››éƒ¨åˆ†ï¼šå®Œæ•´é¡¹ç›®å®æˆ˜ ==================== -->

        <h2 id="part4">ç¬¬å››éƒ¨åˆ†ï¼šå®Œæ•´é¡¹ç›®å®æˆ˜</h2>
        
        <div class="intro">
            <p><strong>ğŸ¯ é¡¹ç›®ç›®æ ‡ï¼š</strong>æ„å»ºä¸€ä¸ªå®Œæ•´çš„åšå®¢APIç³»ç»Ÿ</p>
            <p><strong>ğŸ“¦ åŠŸèƒ½æ¨¡å—ï¼š</strong>ç”¨æˆ·è®¤è¯ï¼ˆJWTï¼‰+ åšå®¢æ–‡ç« ç®¡ç† + è¯„è®ºç³»ç»Ÿ</p>
        </div>

        <h3 id="project-init">4.1 é¡¹ç›®åˆå§‹åŒ–</h3>
        
        <h4>æ­¥éª¤1ï¼šåˆ›å»ºDjangoé¡¹ç›®</h4>
        <pre><code># ç¡®ä¿è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
# åˆ›å»ºé¡¹ç›®
django-admin startproject config .

# åˆ›å»ºåº”ç”¨
python manage.py startapp accounts  # ç”¨æˆ·è®¤è¯
python manage.py startapp blog      # åšå®¢åŠŸèƒ½

# é¡¹ç›®ç»“æ„
drf_tutorial/
â”œâ”€â”€ config/           # é¡¹ç›®é…ç½®
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ wsgi.py
â”œâ”€â”€ accounts/         # ç”¨æˆ·åº”ç”¨
â”‚   â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ admin.py
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ serializers.py
â”‚   â”œâ”€â”€ views.py
â”‚   â””â”€â”€ urls.py
â”œâ”€â”€ blog/            # åšå®¢åº”ç”¨
â”‚   â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ admin.py
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ serializers.py
â”‚   â”œâ”€â”€ views.py
â”‚   â””â”€â”€ urls.py
â”œâ”€â”€ manage.py
â””â”€â”€ requirements.txt</code></pre>

        <h4>æ­¥éª¤2ï¼šé…ç½®settings.py</h4>
        <pre><code># config/settings.py
from pathlib import Path
from datetime import timedelta

BASE_DIR = Path(__file__).resolve().parent.parent

SECRET_KEY = 'django-insecure-change-this-in-production'
DEBUG = True
ALLOWED_HOSTS = []

# åº”ç”¨é…ç½®
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # ç¬¬ä¸‰æ–¹åº”ç”¨
    'rest_framework',
    'rest_framework_simplejwt',
    'corsheaders',
    'django_filters',
    'drf_yasg',
    
    # è‡ªå·±çš„åº”ç”¨
    'accounts',
    'blog',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'corsheaders.middleware.CorsMiddleware',  # CORSä¸­é—´ä»¶
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'config.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

# æ•°æ®åº“é…ç½®
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'drf_tutorial',
        'USER': 'drf_user',
        'PASSWORD': 'drf123456',
        'HOST': 'localhost',
        'PORT': '3306',
        'OPTIONS': {
            'charset': 'utf8mb4',
            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",
                    }
                }
            }

# å¦‚æœä½¿ç”¨pymysqlï¼Œåœ¨config/__init__.pyä¸­æ·»åŠ ï¼š
# import pymysql
# pymysql.install_as_MySQLdb()

# å¯†ç éªŒè¯
AUTH_PASSWORD_VALIDATORS = [
    {'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator'},
    {'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator'},
    {'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator'},
    {'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator'},
]

# å›½é™…åŒ–
LANGUAGE_CODE = 'zh-hans'
TIME_ZONE = 'Asia/Shanghai'
USE_I18N = True
USE_TZ = True

# é™æ€æ–‡ä»¶
STATIC_URL = 'static/'
STATIC_ROOT = BASE_DIR / 'staticfiles'

# åª’ä½“æ–‡ä»¶
MEDIA_URL = 'media/'
MEDIA_ROOT = BASE_DIR / 'media'

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

# è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹
AUTH_USER_MODEL = 'accounts.User'

# DRFé…ç½®
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (
        'rest_framework_simplejwt.authentication.JWTAuthentication',
        'rest_framework.authentication.SessionAuthentication',
    ),
    'DEFAULT_PERMISSION_CLASSES': (
        'rest_framework.permissions.IsAuthenticatedOrReadOnly',
    ),
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10,
    'DEFAULT_FILTER_BACKENDS': (
        'django_filters.rest_framework.DjangoFilterBackend',
        'rest_framework.filters.SearchFilter',
        'rest_framework.filters.OrderingFilter',
    ),
    'DATETIME_FORMAT': '%Y-%m-%d %H:%M:%S',
}

# JWTé…ç½®
SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(hours=2),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
    'ROTATE_REFRESH_TOKENS': True,
    'BLACKLIST_AFTER_ROTATION': True,
    'ALGORITHM': 'HS256',
    'SIGNING_KEY': SECRET_KEY,
    'AUTH_HEADER_TYPES': ('Bearer',),
    'USER_ID_FIELD': 'id',
    'USER_ID_CLAIM': 'user_id',
}

# CORSé…ç½®
CORS_ALLOW_ALL_ORIGINS = True
CORS_ALLOW_CREDENTIALS = True</code></pre>

        <h3 id="user-system">4.2 ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆæ³¨å†Œ/ç™»å½•/JWTï¼‰</h3>
        
        <h4>4.2.1 åˆ›å»ºç”¨æˆ·æ¨¡å‹</h4>
        <pre><code># accounts/models.py
from django.contrib.auth.models import AbstractUser
from django.db import models

class User(AbstractUser):
    """
    è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹
    æ‰©å±•Djangoé»˜è®¤çš„Useræ¨¡å‹
    """
    # æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰
    phone = models.CharField(
        max_length=11, 
        unique=True, 
        null=True, 
        blank=True,
        verbose_name='æ‰‹æœºå·',
        help_text='ç”¨æˆ·æ‰‹æœºå·'
    )
    
    # å¤´åƒ
    avatar = models.ImageField(
        upload_to='avatars/%Y/%m/', 
        null=True, 
        blank=True,
        verbose_name='å¤´åƒ',
        help_text='ç”¨æˆ·å¤´åƒå›¾ç‰‡'
    )
    
    # æ€§åˆ«
    GENDER_CHOICES = (
        (0, 'æœªçŸ¥'),
        (1, 'ç”·'),
        (2, 'å¥³'),
    )
    gender = models.SmallIntegerField(
        choices=GENDER_CHOICES, 
        default=0,
        verbose_name='æ€§åˆ«'
    )
    
    # ä¸ªäººç®€ä»‹
    bio = models.TextField(
        max_length=500, 
        blank=True,
        verbose_name='ä¸ªäººç®€ä»‹',
        help_text='è‡ªæˆ‘ä»‹ç»ï¼Œæœ€å¤š500å­—'
    )
    
    # åˆ›å»ºæ—¶é—´
    created_at = models.DateTimeField(
        auto_now_add=True,
        verbose_name='åˆ›å»ºæ—¶é—´'
    )
    
    # æ›´æ–°æ—¶é—´
    updated_at = models.DateTimeField(
        auto_now=True,
        verbose_name='æ›´æ–°æ—¶é—´'
    )
    
    class Meta:
        db_table = 'user'
        verbose_name = 'ç”¨æˆ·'
        verbose_name_plural = verbose_name
        ordering = ['-created_at']
    
    def __str__(self):
        return self.username</code></pre>

        <h4>4.2.2 åˆ›å»ºç”¨æˆ·åºåˆ—åŒ–å™¨</h4>
        <pre><code># accounts/serializers.py
from rest_framework import serializers
from django.contrib.auth import get_user_model
from django.contrib.auth.password_validation import validate_password

User = get_user_model()

class UserSerializer(serializers.ModelSerializer):
    """
    ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–å™¨
    ç”¨äºå±•ç¤ºç”¨æˆ·ä¿¡æ¯
    """
    class Meta:
        model = User
        fields = [
            'id', 'username', 'email', 'phone', 
            'avatar', 'gender', 'bio', 
            'date_joined', 'last_login'
        ]
        read_only_fields = ['id', 'date_joined', 'last_login']


class UserRegisterSerializer(serializers.ModelSerializer):
    """
    ç”¨æˆ·æ³¨å†Œåºåˆ—åŒ–å™¨
    """
    # å¯†ç ç¡®è®¤å­—æ®µï¼ˆä¸ä¿å­˜åˆ°æ•°æ®åº“ï¼Œåªç”¨äºéªŒè¯ï¼‰
    password_confirm = serializers.CharField(
        write_only=True,
        required=True,
        style={'input_type': 'password'},
        label='ç¡®è®¤å¯†ç '
    )
    
    class Meta:
        model = User
        fields = ['username', 'email', 'password', 'password_confirm', 'phone']
        extra_kwargs = {
            'password': {
                'write_only': True,  # åªå†™ä¸è¯»ï¼ˆä¸ä¼šåœ¨å“åº”ä¸­è¿”å›ï¼‰
                'style': {'input_type': 'password'},
                'label': 'å¯†ç '
            },
            'email': {'required': True, 'label': 'é‚®ç®±'},
            'username': {'label': 'ç”¨æˆ·å'},
            'phone': {'required': False, 'label': 'æ‰‹æœºå·'}
        }
    
    def validate_username(self, value):
        """
        éªŒè¯ç”¨æˆ·å
        """
        if len(value) < 3:
            raise serializers.ValidationError('ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦')
        if User.objects.filter(username=value).exists():
            raise serializers.ValidationError('ç”¨æˆ·åå·²å­˜åœ¨')
        return value
    
    def validate_email(self, value):
        """
        éªŒè¯é‚®ç®±
        """
        if User.objects.filter(email=value).exists():
            raise serializers.ValidationError('é‚®ç®±å·²è¢«æ³¨å†Œ')
        return value
    
    def validate_phone(self, value):
        """
        éªŒè¯æ‰‹æœºå·
        """
        if value and len(value) != 11:
            raise serializers.ValidationError('æ‰‹æœºå·å¿…é¡»æ˜¯11ä½')
        if value and User.objects.filter(phone=value).exists():
            raise serializers.ValidationError('æ‰‹æœºå·å·²è¢«æ³¨å†Œ')
        return value
    
    def validate_password(self, value):
        """
        éªŒè¯å¯†ç å¼ºåº¦
        """
        validate_password(value)  # ä½¿ç”¨Djangoçš„å¯†ç éªŒè¯å™¨
        return value
    
    def validate(self, attrs):
        """
        å¤šå­—æ®µè”åˆéªŒè¯
        """
        # æ£€æŸ¥ä¸¤æ¬¡å¯†ç æ˜¯å¦ä¸€è‡´
        if attrs['password'] != attrs['password_confirm']:
            raise serializers.ValidationError({
                'password_confirm': 'ä¸¤æ¬¡å¯†ç ä¸ä¸€è‡´'
            })
        return attrs
    
    def create(self, validated_data):
        """
        åˆ›å»ºç”¨æˆ·
        """
        # ç§»é™¤password_confirmå­—æ®µ
        validated_data.pop('password_confirm')
        
        # ä½¿ç”¨create_useræ–¹æ³•åˆ›å»ºç”¨æˆ·ï¼ˆä¼šè‡ªåŠ¨åŠ å¯†å¯†ç ï¼‰
        user = User.objects.create_user(**validated_data)
        return user


class UserLoginSerializer(serializers.Serializer):
    """
    ç”¨æˆ·ç™»å½•åºåˆ—åŒ–å™¨
    """
    username = serializers.CharField(
        required=True,
        label='ç”¨æˆ·å'
    )
    password = serializers.CharField(
        required=True,
        write_only=True,
        style={'input_type': 'password'},
        label='å¯†ç '
    )


class ChangePasswordSerializer(serializers.Serializer):
    """
    ä¿®æ”¹å¯†ç åºåˆ—åŒ–å™¨
    """
    old_password = serializers.CharField(
        required=True,
        write_only=True,
        style={'input_type': 'password'},
        label='æ—§å¯†ç '
    )
    new_password = serializers.CharField(
        required=True,
        write_only=True,
        style={'input_type': 'password'},
        label='æ–°å¯†ç '
    )
    new_password_confirm = serializers.CharField(
        required=True,
        write_only=True,
        style={'input_type': 'password'},
        label='ç¡®è®¤æ–°å¯†ç '
    )
    
    def validate_old_password(self, value):
        """
        éªŒè¯æ—§å¯†ç æ˜¯å¦æ­£ç¡®
        """
        user = self.context['request'].user
        if not user.check_password(value):
            raise serializers.ValidationError('æ—§å¯†ç é”™è¯¯')
        return value
    
    def validate_new_password(self, value):
        """
        éªŒè¯æ–°å¯†ç å¼ºåº¦
        """
        validate_password(value)
        return value
    
    def validate(self, attrs):
        """
        éªŒè¯ä¸¤æ¬¡æ–°å¯†ç æ˜¯å¦ä¸€è‡´
        """
        if attrs['new_password'] != attrs['new_password_confirm']:
            raise serializers.ValidationError({
                'new_password_confirm': 'ä¸¤æ¬¡æ–°å¯†ç ä¸ä¸€è‡´'
            })
        return attrs
    
    def save(self):
        """
        ä¿å­˜æ–°å¯†ç 
        """
        user = self.context['request'].user
        user.set_password(self.validated_data['new_password'])
        user.save()
        return user</code></pre>

        <h4>4.2.3 åˆ›å»ºç”¨æˆ·è§†å›¾</h4>
        <pre><code># accounts/views.py
from rest_framework import status, generics, permissions
from rest_framework.decorators import api_view, permission_classes
from rest_framework.response import Response
from rest_framework.permissions import AllowAny, IsAuthenticated
from rest_framework_simplejwt.tokens import RefreshToken
from django.contrib.auth import authenticate, get_user_model
from .serializers import (
    UserSerializer, 
    UserRegisterSerializer, 
    UserLoginSerializer,
    ChangePasswordSerializer
)

User = get_user_model()


class UserRegisterView(generics.CreateAPIView):
    """
    ç”¨æˆ·æ³¨å†Œè§†å›¾
    POST /api/accounts/register/
    """
    queryset = User.objects.all()
    serializer_class = UserRegisterSerializer
    permission_classes = [AllowAny]  # å…è®¸ä»»ä½•äººæ³¨å†Œ
    
    def create(self, request, *args, **kwargs):
        """
        é‡å†™createæ–¹æ³•ï¼Œè¿”å›è‡ªå®šä¹‰å“åº”
        """
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        user = serializer.save()
        
        # ç”ŸæˆJWT Token
        refresh = RefreshToken.for_user(user)
        
        return Response({
            'code': 0,
            'message': 'æ³¨å†ŒæˆåŠŸ',
            'data': {
                'user': UserSerializer(user).data,
                'tokens': {
                    'refresh': str(refresh),
                    'access': str(refresh.access_token),
                }
            }
        }, status=status.HTTP_201_CREATED)


@api_view(['POST'])
@permission_classes([AllowAny])
def user_login(request):
    """
    ç”¨æˆ·ç™»å½•è§†å›¾
    POST /api/accounts/login/
    
    è¯·æ±‚ä½“ï¼š
    {
        "username": "user1",
        "password": "password123"
    }
    """
    serializer = UserLoginSerializer(data=request.data)
    serializer.is_valid(raise_exception=True)
    
    username = serializer.validated_data['username']
    password = serializer.validated_data['password']
    
    # éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
    user = authenticate(username=username, password=password)
    
    if user is None:
        return Response({
            'code': 1,
            'message': 'ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯'
        }, status=status.HTTP_400_BAD_REQUEST)
    
    if not user.is_active:
        return Response({
            'code': 1,
            'message': 'è´¦å·å·²è¢«ç¦ç”¨'
        }, status=status.HTTP_400_BAD_REQUEST)
    
    # ç”ŸæˆJWT Token
    refresh = RefreshToken.for_user(user)
    
    return Response({
        'code': 0,
        'message': 'ç™»å½•æˆåŠŸ',
        'data': {
            'user': UserSerializer(user).data,
            'tokens': {
                'refresh': str(refresh),
                'access': str(refresh.access_token),
            }
        }
    })


@api_view(['POST'])
@permission_classes([IsAuthenticated])
def user_logout(request):
    """
    ç”¨æˆ·ç™»å‡ºè§†å›¾
    POST /api/accounts/logout/
    
    è¯·æ±‚ä½“ï¼š
    {
        "refresh": "refresh_token"
    }
    """
    try:
        refresh_token = request.data.get('refresh')
        token = RefreshToken(refresh_token)
        token.blacklist()  # å°†tokenåŠ å…¥é»‘åå•
        
        return Response({
            'code': 0,
            'message': 'ç™»å‡ºæˆåŠŸ'
        })
    except Exception as e:
        return Response({
            'code': 1,
            'message': 'ç™»å‡ºå¤±è´¥'
        }, status=status.HTTP_400_BAD_REQUEST)


class UserProfileView(generics.RetrieveUpdateAPIView):
    """
    ç”¨æˆ·ä¸ªäººä¿¡æ¯è§†å›¾
    GET /api/accounts/profile/ - è·å–ä¸ªäººä¿¡æ¯
    PUT /api/accounts/profile/ - æ›´æ–°ä¸ªäººä¿¡æ¯
    PATCH /api/accounts/profile/ - éƒ¨åˆ†æ›´æ–°
    """
    serializer_class = UserSerializer
    permission_classes = [IsAuthenticated]
    
    def get_object(self):
        """
        è¿”å›å½“å‰ç™»å½•ç”¨æˆ·
        """
        return self.request.user
    
    def retrieve(self, request, *args, **kwargs):
        """
        è·å–ä¸ªäººä¿¡æ¯
        """
        instance = self.get_object()
        serializer = self.get_serializer(instance)
        return Response({
            'code': 0,
            'message': 'è·å–æˆåŠŸ',
            'data': serializer.data
        })
    
    def update(self, request, *args, **kwargs):
        """
        æ›´æ–°ä¸ªäººä¿¡æ¯
        """
        partial = kwargs.pop('partial', False)
        instance = self.get_object()
        serializer = self.get_serializer(instance, data=request.data, partial=partial)
        serializer.is_valid(raise_exception=True)
        serializer.save()
        
        return Response({
            'code': 0,
            'message': 'æ›´æ–°æˆåŠŸ',
            'data': serializer.data
        })


class ChangePasswordView(generics.UpdateAPIView):
    """
    ä¿®æ”¹å¯†ç è§†å›¾
    PUT /api/accounts/change-password/
    """
    serializer_class = ChangePasswordSerializer
    permission_classes = [IsAuthenticated]
    
    def update(self, request, *args, **kwargs):
        """
        ä¿®æ”¹å¯†ç 
        """
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        serializer.save()
        
        return Response({
            'code': 0,
            'message': 'å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•'
        })</code></pre>

        <h4>4.2.4 é…ç½®URLè·¯ç”±</h4>
        <pre><code># accounts/urls.py
from django.urls import path
from rest_framework_simplejwt.views import TokenRefreshView
from . import views

urlpatterns = [
    # ç”¨æˆ·æ³¨å†Œ
    path('register/', views.UserRegisterView.as_view(), name='user-register'),
    
    # ç”¨æˆ·ç™»å½•
    path('login/', views.user_login, name='user-login'),
    
    # ç”¨æˆ·ç™»å‡º
    path('logout/', views.user_logout, name='user-logout'),
    
    # åˆ·æ–°Token
    path('token/refresh/', TokenRefreshView.as_view(), name='token-refresh'),
    
    # ç”¨æˆ·ä¸ªäººä¿¡æ¯
    path('profile/', views.UserProfileView.as_view(), name='user-profile'),
    
    # ä¿®æ”¹å¯†ç 
    path('change-password/', views.ChangePasswordView.as_view(), name='change-password'),
]


# config/urls.pyï¼ˆä¸»URLé…ç½®ï¼‰
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static
from rest_framework import permissions
from drf_yasg.views import get_schema_view
from drf_yasg import openapi

# Swaggeræ–‡æ¡£é…ç½®
schema_view = get_schema_view(
    openapi.Info(
        title="åšå®¢APIæ–‡æ¡£",
        default_version='v1',
        description="Django REST Framework å®Œæ•´æ•™ç¨‹ç¤ºä¾‹é¡¹ç›®",
        contact=openapi.Contact(email="admin@example.com"),
    ),
    public=True,
    permission_classes=[permissions.AllowAny],
)

urlpatterns = [
    # Djangoç®¡ç†åå°
    path('admin/', admin.site.urls),
    
    # ç”¨æˆ·è®¤è¯API
    path('api/accounts/', include('accounts.urls')),
    
    # åšå®¢API
    path('api/', include('blog.urls')),
    
    # APIæ–‡æ¡£
    path('swagger/', schema_view.with_ui('swagger', cache_timeout=0), name='schema-swagger-ui'),
    path('redoc/', schema_view.with_ui('redoc', cache_timeout=0), name='schema-redoc'),
]

# å¼€å‘ç¯å¢ƒä¸‹æä¾›åª’ä½“æ–‡ä»¶è®¿é—®
if settings.DEBUG:
    urlpatterns += static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)</code></pre>

        <h4>4.2.5 æ‰§è¡Œæ•°æ®åº“è¿ç§»</h4>
        <pre><code># ç”Ÿæˆè¿ç§»æ–‡ä»¶
python manage.py makemigrations

# æ‰§è¡Œè¿ç§»
python manage.py migrate

# åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">âœ…</div>
                è¿ç§»æˆåŠŸæˆªå›¾<br>
                æ˜¾ç¤ºï¼šRunning migrations... OK
            </div>
        </div>

        <h3 id="blog-system">4.3 åšå®¢ç³»ç»Ÿå¼€å‘</h3>
        
        <h4>4.3.1 åˆ›å»ºåšå®¢æ¨¡å‹</h4>
        <pre><code># blog/models.py
from django.db import models
from django.conf import settings

class Category(models.Model):
    """
    æ–‡ç« åˆ†ç±»æ¨¡å‹
    """
    name = models.CharField(
        max_length=50, 
        unique=True,
        verbose_name='åˆ†ç±»åç§°'
    )
    description = models.TextField(
        blank=True,
        verbose_name='åˆ†ç±»æè¿°'
    )
    created_at = models.DateTimeField(
        auto_now_add=True,
        verbose_name='åˆ›å»ºæ—¶é—´'
    )
    
    class Meta:
        db_table = 'category'
        verbose_name = 'åˆ†ç±»'
        verbose_name_plural = verbose_name
        ordering = ['name']
    
    def __str__(self):
        return self.name


class Post(models.Model):
    """
    åšå®¢æ–‡ç« æ¨¡å‹
    """
    # æ ‡é¢˜
    title = models.CharField(
        max_length=200,
        verbose_name='æ ‡é¢˜'
    )
    
    # å†…å®¹
    content = models.TextField(
        verbose_name='å†…å®¹'
    )
    
    # æ‘˜è¦
    summary = models.CharField(
        max_length=500, 
        blank=True,
        verbose_name='æ‘˜è¦',
        help_text='æ–‡ç« æ‘˜è¦ï¼Œä¸å¡«å†™åˆ™è‡ªåŠ¨æˆªå–å†…å®¹å‰200å­—'
    )
    
    # ä½œè€…ï¼ˆå¤–é”®ï¼‰
    author = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='posts',
        verbose_name='ä½œè€…'
    )
    
    # åˆ†ç±»ï¼ˆå¤–é”®ï¼‰
    category = models.ForeignKey(
        Category,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name='posts',
        verbose_name='åˆ†ç±»'
    )
    
    # å°é¢å›¾
    cover = models.ImageField(
        upload_to='covers/%Y/%m/',
        null=True,
        blank=True,
        verbose_name='å°é¢å›¾'
    )
    
    # çŠ¶æ€
    STATUS_CHOICES = (
        ('draft', 'è‰ç¨¿'),
        ('published', 'å·²å‘å¸ƒ'),
    )
    status = models.CharField(
        max_length=10,
        choices=STATUS_CHOICES,
        default='draft',
        verbose_name='çŠ¶æ€'
    )
    
    # æµè§ˆæ¬¡æ•°
    views = models.PositiveIntegerField(
        default=0,
        verbose_name='æµè§ˆæ¬¡æ•°'
    )
    
    # ç‚¹èµæ¬¡æ•°
    likes = models.PositiveIntegerField(
        default=0,
        verbose_name='ç‚¹èµæ¬¡æ•°'
    )
    
    # æ˜¯å¦ç½®é¡¶
    is_top = models.BooleanField(
        default=False,
        verbose_name='æ˜¯å¦ç½®é¡¶'
    )
    
    # åˆ›å»ºæ—¶é—´
    created_at = models.DateTimeField(
        auto_now_add=True,
        verbose_name='åˆ›å»ºæ—¶é—´'
    )
    
    # æ›´æ–°æ—¶é—´
    updated_at = models.DateTimeField(
        auto_now=True,
        verbose_name='æ›´æ–°æ—¶é—´'
    )
    
    class Meta:
        db_table = 'post'
        verbose_name = 'æ–‡ç« '
        verbose_name_plural = verbose_name
        ordering = ['-is_top', '-created_at']
        indexes = [
            models.Index(fields=['-created_at']),
            models.Index(fields=['status']),
        ]
    
    def __str__(self):
        return self.title
    
    def save(self, *args, **kwargs):
        """
        é‡å†™saveæ–¹æ³•ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
        """
        if not self.summary and self.content:
            self.summary = self.content[:200]
        super().save(*args, **kwargs)


class Comment(models.Model):
    """
    è¯„è®ºæ¨¡å‹
    """
    # å…³è”æ–‡ç« 
    post = models.ForeignKey(
        Post,
        on_delete=models.CASCADE,
        related_name='comments',
        verbose_name='æ–‡ç« '
    )
    
    # è¯„è®ºç”¨æˆ·
    user = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='comments',
        verbose_name='ç”¨æˆ·'
    )
    
    # è¯„è®ºå†…å®¹
    content = models.TextField(
        verbose_name='è¯„è®ºå†…å®¹'
    )
    
    # çˆ¶è¯„è®ºï¼ˆå®ç°è¯„è®ºå›å¤åŠŸèƒ½ï¼‰
    parent = models.ForeignKey(
        'self',
        on_delete=models.CASCADE,
        null=True,
        blank=True,
        related_name='replies',
        verbose_name='çˆ¶è¯„è®º'
    )
    
    # åˆ›å»ºæ—¶é—´
    created_at = models.DateTimeField(
        auto_now_add=True,
        verbose_name='åˆ›å»ºæ—¶é—´'
    )
    
    class Meta:
        db_table = 'comment'
        verbose_name = 'è¯„è®º'
        verbose_name_plural = verbose_name
        ordering = ['-created_at']
    
    def __str__(self):
        return f'{self.user.username}: {self.content[:20]}'</code></pre>

        <h4>4.3.2 åˆ›å»ºåšå®¢åºåˆ—åŒ–å™¨</h4>
        <pre><code># blog/serializers.py
from rest_framework import serializers
from .models import Category, Post, Comment
from accounts.serializers import UserSerializer


class CategorySerializer(serializers.ModelSerializer):
    """
    åˆ†ç±»åºåˆ—åŒ–å™¨
    """
    # ç»Ÿè®¡è¯¥åˆ†ç±»ä¸‹çš„æ–‡ç« æ•°é‡
    post_count = serializers.SerializerMethodField()
    
    class Meta:
        model = Category
        fields = ['id', 'name', 'description', 'post_count', 'created_at']
        read_only_fields = ['id', 'created_at']
    
    def get_post_count(self, obj):
        """
        è·å–åˆ†ç±»ä¸‹çš„æ–‡ç« æ•°é‡
        """
        return obj.posts.filter(status='published').count()


class CommentSerializer(serializers.ModelSerializer):
    """
    è¯„è®ºåºåˆ—åŒ–å™¨
    """
    # åµŒå¥—æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
    user = UserSerializer(read_only=True)
    # ç”¨äºåˆ›å»ºè¯„è®ºæ—¶ä¼ å…¥ç”¨æˆ·ID
    user_id = serializers.IntegerField(write_only=True, required=False)
    # æ˜¾ç¤ºå›å¤æ•°é‡
    reply_count = serializers.SerializerMethodField()
    
    class Meta:
        model = Comment
        fields = [
            'id', 'post', 'user', 'user_id', 
            'content', 'parent', 'reply_count',
            'created_at'
        ]
        read_only_fields = ['id', 'created_at']
    
    def get_reply_count(self, obj):
        """
        è·å–è¯„è®ºçš„å›å¤æ•°é‡
        """
        return obj.replies.count()
    
    def create(self, validated_data):
        """
        åˆ›å»ºè¯„è®ºæ—¶è‡ªåŠ¨è®¾ç½®å½“å‰ç”¨æˆ·
        """
        validated_data['user'] = self.context['request'].user
        return super().create(validated_data)


class PostListSerializer(serializers.ModelSerializer):
    """
    æ–‡ç« åˆ—è¡¨åºåˆ—åŒ–å™¨ï¼ˆç®€åŒ–ç‰ˆï¼Œç”¨äºåˆ—è¡¨å±•ç¤ºï¼‰
    """
    author = UserSerializer(read_only=True)
    category = CategorySerializer(read_only=True)
    comment_count = serializers.SerializerMethodField()
    
    class Meta:
        model = Post
        fields = [
            'id', 'title', 'summary', 'author', 
            'category', 'cover', 'status', 
            'views', 'likes', 'is_top',
            'comment_count', 'created_at', 'updated_at'
        ]
        read_only_fields = ['id', 'views', 'likes', 'created_at', 'updated_at']
    
    def get_comment_count(self, obj):
        """
        è·å–è¯„è®ºæ•°é‡
        """
        return obj.comments.count()


class PostDetailSerializer(serializers.ModelSerializer):
    """
    æ–‡ç« è¯¦æƒ…åºåˆ—åŒ–å™¨ï¼ˆå®Œæ•´ç‰ˆï¼ŒåŒ…å«å…¨éƒ¨å†…å®¹ï¼‰
    """
    author = UserSerializer(read_only=True)
    category = CategorySerializer(read_only=True)
    category_id = serializers.IntegerField(write_only=True, required=False, allow_null=True)
    comments = CommentSerializer(many=True, read_only=True)
    comment_count = serializers.SerializerMethodField()
    
    class Meta:
        model = Post
        fields = [
            'id', 'title', 'content', 'summary',
            'author', 'category', 'category_id',
            'cover', 'status', 'views', 'likes', 
            'is_top', 'comments', 'comment_count',
            'created_at', 'updated_at'
        ]
        read_only_fields = ['id', 'author', 'views', 'likes', 'created_at', 'updated_at']
    
    def get_comment_count(self, obj):
        return obj.comments.count()
    
    def create(self, validated_data):
        """
        åˆ›å»ºæ–‡ç« æ—¶è‡ªåŠ¨è®¾ç½®ä½œè€…ä¸ºå½“å‰ç”¨æˆ·
        """
        validated_data['author'] = self.context['request'].user
        return super().create(validated_data)


class PostCreateUpdateSerializer(serializers.ModelSerializer):
    """
    æ–‡ç« åˆ›å»º/æ›´æ–°åºåˆ—åŒ–å™¨
    """
    class Meta:
        model = Post
        fields = [
            'title', 'content', 'summary',
            'category', 'cover', 'status', 'is_top'
        ]
    
    def create(self, validated_data):
        validated_data['author'] = self.context['request'].user
        return super().create(validated_data)</code></pre>

        <h4>4.3.3 åˆ›å»ºåšå®¢è§†å›¾</h4>
        <pre><code># blog/views.py
from rest_framework import viewsets, status, filters
from rest_framework.decorators import action
from rest_framework.response import Response
from rest_framework.permissions import IsAuthenticatedOrReadOnly, IsAuthenticated
from django_filters.rest_framework import DjangoFilterBackend
from .models import Category, Post, Comment
from .serializers import (
    CategorySerializer,
    PostListSerializer,
    PostDetailSerializer,
    PostCreateUpdateSerializer,
    CommentSerializer
)
from .permissions import IsAuthorOrReadOnly

class CategoryViewSet(viewsets.ModelViewSet):
    """
    åˆ†ç±»è§†å›¾é›†
    list: GET /api/categories/ - è·å–åˆ†ç±»åˆ—è¡¨
    create: POST /api/categories/ - åˆ›å»ºåˆ†ç±»
    retrieve: GET /api/categories/{id}/ - è·å–åˆ†ç±»è¯¦æƒ…
    update: PUT /api/categories/{id}/ - æ›´æ–°åˆ†ç±»
    destroy: DELETE /api/categories/{id}/ - åˆ é™¤åˆ†ç±»
    """
    queryset = Category.objects.all()
    serializer_class = CategorySerializer
    permission_classes = [IsAuthenticatedOrReadOnly]


class PostViewSet(viewsets.ModelViewSet):
    """
    æ–‡ç« è§†å›¾é›†
    """
    queryset = Post.objects.filter(status='published')
    permission_classes = [IsAuthenticatedOrReadOnly, IsAuthorOrReadOnly]
    
    # é…ç½®è¿‡æ»¤ã€æœç´¢ã€æ’åº
    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]
    filterset_fields = ['category', 'author', 'status']
    search_fields = ['title', 'content', 'summary']
    ordering_fields = ['created_at', 'views', 'likes']
    ordering = ['-is_top', '-created_at']
    
    def get_serializer_class(self):
        """
        æ ¹æ®ä¸åŒçš„actionè¿”å›ä¸åŒçš„åºåˆ—åŒ–å™¨
        """
        if self.action == 'list':
            return PostListSerializer
        elif self.action in ['create', 'update', 'partial_update']:
            return PostCreateUpdateSerializer
        return PostDetailSerializer
    
    def get_queryset(self):
        """
        è‡ªå®šä¹‰æŸ¥è¯¢é›†
        æ™®é€šç”¨æˆ·åªèƒ½çœ‹åˆ°å·²å‘å¸ƒçš„æ–‡ç« 
        ä½œè€…å¯ä»¥çœ‹åˆ°è‡ªå·±çš„æ‰€æœ‰æ–‡ç« 
        """
        queryset = super().get_queryset()
        
        # å¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œå¯ä»¥çœ‹åˆ°è‡ªå·±çš„è‰ç¨¿
        if self.request.user.is_authenticated:
            queryset = Post.objects.filter(
                models.Q(status='published') | 
                models.Q(author=self.request.user)
            )
        
        return queryset
    
    def retrieve(self, request, *args, **kwargs):
        """
        è·å–æ–‡ç« è¯¦æƒ…æ—¶ï¼Œæµè§ˆæ¬¡æ•°+1
        """
        instance = self.get_object()
        # æµè§ˆæ¬¡æ•°+1
        instance.views += 1
        instance.save(update_fields=['views'])
        
        serializer = self.get_serializer(instance)
        return Response({
            'code': 0,
            'message': 'è·å–æˆåŠŸ',
            'data': serializer.data
        })
    
    def create(self, request, *args, **kwargs):
        """
        åˆ›å»ºæ–‡ç« 
        """
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        self.perform_create(serializer)
        
        return Response({
            'code': 0,
            'message': 'åˆ›å»ºæˆåŠŸ',
            'data': PostDetailSerializer(serializer.instance).data
        }, status=status.HTTP_201_CREATED)
    
    def update(self, request, *args, **kwargs):
        """
        æ›´æ–°æ–‡ç« 
        """
        partial = kwargs.pop('partial', False)
        instance = self.get_object()
        serializer = self.get_serializer(instance, data=request.data, partial=partial)
        serializer.is_valid(raise_exception=True)
        self.perform_update(serializer)
        
        return Response({
            'code': 0,
            'message': 'æ›´æ–°æˆåŠŸ',
            'data': PostDetailSerializer(serializer.instance).data
        })
    
    def destroy(self, request, *args, **kwargs):
        """
        åˆ é™¤æ–‡ç« 
        """
        instance = self.get_object()
        self.perform_destroy(instance)
        return Response({
            'code': 0,
            'message': 'åˆ é™¤æˆåŠŸ'
        }, status=status.HTTP_204_NO_CONTENT)
    
    @action(detail=True, methods=['post'], permission_classes=[IsAuthenticated])
    def like(self, request, pk=None):
        """
        ç‚¹èµæ–‡ç« 
        POST /api/posts/{id}/like/
        """
        post = self.get_object()
        post.likes += 1
        post.save(update_fields=['likes'])
        
        return Response({
            'code': 0,
            'message': 'ç‚¹èµæˆåŠŸ',
            'data': {'likes': post.likes}
        })
    
    @action(detail=False, methods=['get'])
    def my_posts(self, request):
        """
        è·å–æˆ‘çš„æ–‡ç« 
        GET /api/posts/my_posts/
        """
        if not request.user.is_authenticated:
            return Response({
                'code': 1,
                'message': 'è¯·å…ˆç™»å½•'
            }, status=status.HTTP_401_UNAUTHORIZED)
        
        queryset = Post.objects.filter(author=request.user)
        queryset = self.filter_queryset(queryset)
        
        page = self.paginate_queryset(queryset)
        if page is not None:
            serializer = PostListSerializer(page, many=True)
            return self.get_paginated_response(serializer.data)
        
        serializer = PostListSerializer(queryset, many=True)
        return Response({
            'code': 0,
            'message': 'è·å–æˆåŠŸ',
            'data': serializer.data
        })


class CommentViewSet(viewsets.ModelViewSet):
    """
    è¯„è®ºè§†å›¾é›†
    """
    queryset = Comment.objects.all()
    serializer_class = CommentSerializer
    permission_classes = [IsAuthenticatedOrReadOnly]
    filter_backends = [DjangoFilterBackend]
    filterset_fields = ['post', 'user', 'parent']
    
    def create(self, request, *args, **kwargs):
        """
        åˆ›å»ºè¯„è®º
        """
        serializer = self.get_serializer(data=request.data)
        serializer.is_valid(raise_exception=True)
        self.perform_create(serializer)
        
        return Response({
            'code': 0,
            'message': 'è¯„è®ºæˆåŠŸ',
            'data': serializer.data
        }, status=status.HTTP_201_CREATED)</code></pre>

        <h4>4.3.4 åˆ›å»ºè‡ªå®šä¹‰æƒé™</h4>
        <pre><code># blog/permissions.py
from rest_framework import permissions

class IsAuthorOrReadOnly(permissions.BasePermission):
    """
    è‡ªå®šä¹‰æƒé™ï¼šåªæœ‰ä½œè€…æ‰èƒ½ç¼–è¾‘/åˆ é™¤æ–‡ç« 
    å…¶ä»–äººåªèƒ½æŸ¥çœ‹
    """
    
    def has_permission(self, request, view):
        """
        æ‰€æœ‰äººéƒ½å¯ä»¥è®¿é—®
        """
        # è¯»æ“ä½œï¼ˆGETã€HEADã€OPTIONSï¼‰å…è®¸æ‰€æœ‰äºº
        if request.method in permissions.SAFE_METHODS:
            return True
        
        # å†™æ“ä½œéœ€è¦è®¤è¯
        return request.user and request.user.is_authenticated
    
    def has_object_permission(self, request, view, obj):
        """
        å¯¹è±¡çº§åˆ«æƒé™æ£€æŸ¥
        """
        # è¯»æ“ä½œå…è®¸æ‰€æœ‰äºº
        if request.method in permissions.SAFE_METHODS:
            return True
        
        # å†™æ“ä½œåªå…è®¸ä½œè€…æˆ–ç®¡ç†å‘˜
        return obj.author == request.user or request.user.is_staff</code></pre>

        <h4>4.3.5 é…ç½®URLè·¯ç”±</h4>
        <pre><code># blog/urls.py
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import views

# åˆ›å»ºè·¯ç”±å™¨
router = DefaultRouter()

# æ³¨å†ŒViewSet
router.register(r'categories', views.CategoryViewSet, basename='category')
router.register(r'posts', views.PostViewSet, basename='post')
router.register(r'comments', views.CommentViewSet, basename='comment')

urlpatterns = [
    path('', include(router.urls)),
]</code></pre>

        <h4>4.3.6 æ³¨å†Œæ¨¡å‹åˆ°Admin</h4>
        <pre><code># accounts/admin.py
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .models import User

@admin.register(User)
class CustomUserAdmin(UserAdmin):
    """
    è‡ªå®šä¹‰ç”¨æˆ·ç®¡ç†
    """
    list_display = ['username', 'email', 'phone', 'gender', 'is_staff', 'date_joined']
    list_filter = ['is_staff', 'is_active', 'gender']
    search_fields = ['username', 'email', 'phone']
    
    fieldsets = UserAdmin.fieldsets + (
        ('é¢å¤–ä¿¡æ¯', {'fields': ('phone', 'avatar', 'gender', 'bio')}),
    )


# blog/admin.py
from django.contrib import admin
from .models import Category, Post, Comment

@admin.register(Category)
class CategoryAdmin(admin.ModelAdmin):
    """
    åˆ†ç±»ç®¡ç†
    """
    list_display = ['name', 'description', 'created_at']
    search_fields = ['name']


@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    """
    æ–‡ç« ç®¡ç†
    """
    list_display = ['title', 'author', 'category', 'status', 'is_top', 'views', 'likes', 'created_at']
    list_filter = ['status', 'is_top', 'category', 'created_at']
    search_fields = ['title', 'content']
    date_hierarchy = 'created_at'
    
    fieldsets = (
        ('åŸºæœ¬ä¿¡æ¯', {
            'fields': ('title', 'author', 'category', 'cover')
        }),
        ('å†…å®¹', {
            'fields': ('content', 'summary')
        }),
        ('è®¾ç½®', {
            'fields': ('status', 'is_top')
        }),
        ('ç»Ÿè®¡', {
            'fields': ('views', 'likes'),
            'classes': ('collapse',)
        }),
    )
    
    readonly_fields = ['views', 'likes']


@admin.register(Comment)
class CommentAdmin(admin.ModelAdmin):
    """
    è¯„è®ºç®¡ç†
    """
    list_display = ['user', 'post', 'content_short', 'parent', 'created_at']
    list_filter = ['created_at']
    search_fields = ['content', 'user__username', 'post__title']
    
    def content_short(self, obj):
        """æ˜¾ç¤ºè¯„è®ºå†…å®¹çš„å‰30ä¸ªå­—ç¬¦"""
        return obj.content[:30] + '...' if len(obj.content) > 30 else obj.content
    content_short.short_description = 'è¯„è®ºå†…å®¹'</code></pre>

        <h4>4.3.7 æ‰§è¡Œè¿ç§»</h4>
        <pre><code># ç”Ÿæˆè¿ç§»æ–‡ä»¶
python manage.py makemigrations blog

# æ‰§è¡Œè¿ç§»
python manage.py migrate

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python manage.py runserver</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸš€</div>
                æœåŠ¡å™¨å¯åŠ¨æˆåŠŸæˆªå›¾<br>
                æ˜¾ç¤ºï¼šStarting development server at http://127.0.0.1:8000/
            </div>
        </div>

        <h3 id="api-testing">4.4 APIæµ‹è¯•</h3>
        
        <h4>4.4.1 ä½¿ç”¨DRFæµè§ˆå™¨ç•Œé¢æµ‹è¯•</h4>
        
        <div class="info">
            <strong>ğŸ“ è®¿é—®ä»¥ä¸‹URLè¿›è¡Œæµ‹è¯•ï¼š</strong>
            <ul>
                <li><strong>APIæ ¹ç›®å½•ï¼š</strong>http://127.0.0.1:8000/api/</li>
                <li><strong>Swaggeræ–‡æ¡£ï¼š</strong>http://127.0.0.1:8000/swagger/</li>
                <li><strong>ReDocæ–‡æ¡£ï¼š</strong>http://127.0.0.1:8000/redoc/</li>
                <li><strong>Djangoç®¡ç†åå°ï¼š</strong>http://127.0.0.1:8000/admin/</li>
            </ul>
        </div>

        <h4>4.4.2 æµ‹è¯•ç”¨æˆ·æ³¨å†Œ</h4>
        
        <div class="example-section">
            <h4>ğŸ“Œ æµ‹è¯•æ­¥éª¤ï¼š</h4>
            <pre><code># 1. è®¿é—®æ³¨å†Œæ¥å£
POST http://127.0.0.1:8000/api/accounts/register/

# 2. è¯·æ±‚ä½“ï¼ˆJSONæ ¼å¼ï¼‰
{
    "username": "testuser",
    "email": "test@example.com",
    "password": "Test123456",
    "password_confirm": "Test123456",
    "phone": "13800138000"
}

# 3. é¢„æœŸå“åº”ï¼ˆ201 Createdï¼‰
{
    "code": 0,
    "message": "æ³¨å†ŒæˆåŠŸ",
    "data": {
        "user": {
            "id": 1,
            "username": "testuser",
            "email": "test@example.com",
            "phone": "13800138000",
            "avatar": null,
            "gender": 0,
            "bio": "",
            "date_joined": "2024-01-01 12:00:00",
            "last_login": null
        },
        "tokens": {
            "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc...",
            "access": "eyJ0eXAiOiJKV1QiLCJhbGc..."
        }
    }
}</code></pre>
        </div>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">âœ…</div>
                DRFæµè§ˆå™¨ç•Œé¢æˆªå›¾<br>
                æ˜¾ç¤ºæ³¨å†ŒæˆåŠŸçš„å“åº”æ•°æ®
            </div>
        </div>

        <h4>4.4.3 æµ‹è¯•ç”¨æˆ·ç™»å½•</h4>
        
        <pre><code># 1. è®¿é—®ç™»å½•æ¥å£
POST http://127.0.0.1:8000/api/accounts/login/

# 2. è¯·æ±‚ä½“
{
    "username": "testuser",
    "password": "Test123456"
}

# 3. é¢„æœŸå“åº”ï¼ˆ200 OKï¼‰
{
    "code": 0,
    "message": "ç™»å½•æˆåŠŸ",
    "data": {
        "user": {
            "id": 1,
            "username": "testuser",
            "email": "test@example.com",
            ...
        },
        "tokens": {
            "refresh": "eyJ0eXAiOiJKV1QiLCJhbGc...",
            "access": "eyJ0eXAiOiJKV1QiLCJhbGc..."
        }
    }
}

# 4. ä¿å­˜access tokenï¼Œç”¨äºåç»­è¯·æ±‚çš„è®¤è¯</code></pre>

        <h4>4.4.4 æµ‹è¯•åˆ›å»ºæ–‡ç« ï¼ˆéœ€è¦è®¤è¯ï¼‰</h4>
        
        <pre><code># 1. è®¿é—®åˆ›å»ºæ–‡ç« æ¥å£
POST http://127.0.0.1:8000/api/posts/

# 2. è¯·æ±‚å¤´ï¼ˆæ·»åŠ JWT Tokenï¼‰
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...

# 3. è¯·æ±‚ä½“
{
    "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢",
    "content": "è¿™æ˜¯æ–‡ç« çš„è¯¦ç»†å†…å®¹...",
    "summary": "è¿™æ˜¯æ–‡ç« æ‘˜è¦",
    "category": 1,
    "status": "published",
    "is_top": false
}

# 4. é¢„æœŸå“åº”ï¼ˆ201 Createdï¼‰
{
    "code": 0,
    "message": "åˆ›å»ºæˆåŠŸ",
    "data": {
        "id": 1,
        "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢",
        "content": "è¿™æ˜¯æ–‡ç« çš„è¯¦ç»†å†…å®¹...",
        "author": {
            "id": 1,
            "username": "testuser",
            ...
        },
        ...
    }
}</code></pre>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸ“</div>
                åˆ›å»ºæ–‡ç« æˆåŠŸæˆªå›¾<br>
                æ˜¾ç¤ºæ–°åˆ›å»ºçš„æ–‡ç« æ•°æ®
            </div>
        </div>

        <h4>4.4.5 æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨ï¼ˆå¸¦è¿‡æ»¤å’Œæœç´¢ï¼‰</h4>
        
        <pre><code># 1. è·å–æ‰€æœ‰æ–‡ç« 
GET http://127.0.0.1:8000/api/posts/

# 2. æŒ‰åˆ†ç±»è¿‡æ»¤
GET http://127.0.0.1:8000/api/posts/?category=1

# 3. æœç´¢æ–‡ç« ï¼ˆæœç´¢æ ‡é¢˜å’Œå†…å®¹ï¼‰
GET http://127.0.0.1:8000/api/posts/?search=Django

# 4. ç»„åˆä½¿ç”¨ï¼šæœç´¢+æ’åº+åˆ†é¡µ
GET http://127.0.0.1:8000/api/posts/?search=Python&ordering=-views&page=1

# 5. é¢„æœŸå“åº”
{
    "count": 10,
    "next": "http://127.0.0.1:8000/api/posts/?page=2",
    "previous": null,
    "results": [
        {
            "id": 1,
            "title": "æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢",
            "summary": "è¿™æ˜¯æ–‡ç« æ‘˜è¦",
            "author": {...},
            "category": {...},
            "views": 100,
            "likes": 10,
            ...
        },
        ...
    ]
}</code></pre>

        <h4>4.4.6 ä½¿ç”¨Postmanæµ‹è¯•</h4>
        
        <div class="example-section">
            <h4>ğŸ”§ Postmanæµ‹è¯•æ­¥éª¤ï¼š</h4>
            <ol>
                <li><strong>ä¸‹è½½å¹¶å®‰è£…Postmanï¼š</strong>https://www.postman.com/downloads/</li>
                <li><strong>åˆ›å»ºæ–°çš„Collectionï¼š</strong>å‘½åä¸º"åšå®¢APIæµ‹è¯•"</li>
                <li><strong>æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</strong>
                    <ul>
                        <li>base_url: http://127.0.0.1:8000</li>
                        <li>access_token: ï¼ˆç™»å½•åè·å–ï¼‰</li>
                    </ul>
                </li>
                <li><strong>åˆ›å»ºè¯·æ±‚ï¼š</strong>
                    <ul>
                        <li>ç”¨æˆ·æ³¨å†Œï¼šPOST {{base_url}}/api/accounts/register/</li>
                        <li>ç”¨æˆ·ç™»å½•ï¼šPOST {{base_url}}/api/accounts/login/</li>
                        <li>è·å–ä¸ªäººä¿¡æ¯ï¼šGET {{base_url}}/api/accounts/profile/</li>
                        <li>åˆ›å»ºæ–‡ç« ï¼šPOST {{base_url}}/api/posts/</li>
                        <li>è·å–æ–‡ç« åˆ—è¡¨ï¼šGET {{base_url}}/api/posts/</li>
                    </ul>
                </li>
                <li><strong>è®¾ç½®è®¤è¯ï¼š</strong>åœ¨éœ€è¦è®¤è¯çš„è¯·æ±‚ä¸­ï¼Œæ·»åŠ Headerï¼š
                    <pre><code>Authorization: Bearer {{access_token}}</code></pre>
                </li>
            </ol>
        </div>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸ”¬</div>
                Postmanæµ‹è¯•æˆªå›¾<br>
                æ˜¾ç¤ºå„ä¸ªAPIæ¥å£çš„æµ‹è¯•ç»“æœ
            </div>
        </div>

        <h4>4.4.7 ä½¿ç”¨Python requestsåº“æµ‹è¯•</h4>
        
        <pre><code># test_api.py
import requests
import json

BASE_URL = 'http://127.0.0.1:8000'

def test_register():
    """æµ‹è¯•ç”¨æˆ·æ³¨å†Œ"""
    url = f'{BASE_URL}/api/accounts/register/'
    data = {
        'username': 'testuser2',
        'email': 'test2@example.com',
        'password': 'Test123456',
        'password_confirm': 'Test123456',
        'phone': '13800138001'
    }
    response = requests.post(url, json=data)
    print('æ³¨å†Œç»“æœï¼š', response.status_code)
    print(json.dumps(response.json(), indent=2, ensure_ascii=False))
    return response.json()

def test_login():
    """æµ‹è¯•ç”¨æˆ·ç™»å½•"""
    url = f'{BASE_URL}/api/accounts/login/'
    data = {
        'username': 'testuser2',
        'password': 'Test123456'
    }
    response = requests.post(url, json=data)
    print('ç™»å½•ç»“æœï¼š', response.status_code)
    result = response.json()
    print(json.dumps(result, indent=2, ensure_ascii=False))
    
    # è¿”å›access token
    return result['data']['tokens']['access']

def test_create_post(access_token):
    """æµ‹è¯•åˆ›å»ºæ–‡ç« """
    url = f'{BASE_URL}/api/posts/'
    headers = {
        'Authorization': f'Bearer {access_token}'
    }
    data = {
        'title': 'æµ‹è¯•æ–‡ç« æ ‡é¢˜',
        'content': 'è¿™æ˜¯æµ‹è¯•æ–‡ç« çš„å†…å®¹...',
        'status': 'published'
    }
    response = requests.post(url, json=data, headers=headers)
    print('åˆ›å»ºæ–‡ç« ç»“æœï¼š', response.status_code)
    print(json.dumps(response.json(), indent=2, ensure_ascii=False))

def test_get_posts():
    """æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨"""
    url = f'{BASE_URL}/api/posts/'
    response = requests.get(url)
    print('è·å–æ–‡ç« åˆ—è¡¨ï¼š', response.status_code)
    result = response.json()
    print(f"å…±æœ‰ {result['count']} ç¯‡æ–‡ç« ")
    for post in result['results']:
        print(f"- {post['title']} (æµè§ˆ:{post['views']}, ç‚¹èµ:{post['likes']})")

if __name__ == '__main__':
    # æµ‹è¯•æµç¨‹
    print('=== 1. æµ‹è¯•æ³¨å†Œ ===')
    test_register()
    
    print('\n=== 2. æµ‹è¯•ç™»å½• ===')
    token = test_login()
    
    print('\n=== 3. æµ‹è¯•åˆ›å»ºæ–‡ç«  ===')
    test_create_post(token)
    
    print('\n=== 4. æµ‹è¯•è·å–æ–‡ç« åˆ—è¡¨ ===')
    test_get_posts()</code></pre>

        <h4>4.4.8 APIæ–‡æ¡£æŸ¥çœ‹</h4>
        
        <div class="info">
            <strong>ğŸ“š è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£ï¼š</strong>
            <p>è®¿é—® <code>http://127.0.0.1:8000/swagger/</code> å¯ä»¥çœ‹åˆ°å®Œæ•´çš„APIæ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š</p>
            <ul>
                <li>æ‰€æœ‰æ¥å£çš„URLå’ŒHTTPæ–¹æ³•</li>
                <li>è¯·æ±‚å‚æ•°è¯´æ˜</li>
                <li>å“åº”æ ¼å¼ç¤ºä¾‹</li>
                <li>ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•API</li>
            </ul>
        </div>

        <div class="screenshot">
            <div class="screenshot-placeholder">
                <div class="icon">ğŸ“–</div>
                Swagger APIæ–‡æ¡£æˆªå›¾<br>
                æ˜¾ç¤ºæ‰€æœ‰APIæ¥å£çš„äº¤äº’å¼æ–‡æ¡£
            </div>
        </div>

        <h2>ğŸ‰ æ­å–œå®Œæˆï¼</h2>
        
        <div class="success">
            <strong>âœ… æ‚¨å·²ç»æŒæ¡ï¼š</strong>
            <ol>
                <li>RESTå’ŒRESTful APIçš„æ ¸å¿ƒæ¦‚å¿µ</li>
                <li>DRFçš„æ‰€æœ‰æ ¸å¿ƒç»„ä»¶ï¼ˆåºåˆ—åŒ–å™¨ã€è§†å›¾ã€è®¤è¯ã€æƒé™ç­‰ï¼‰</li>
                <li>JWTè®¤è¯ç³»ç»Ÿçš„å®Œæ•´å®ç°</li>
                <li>å®Œæ•´çš„åšå®¢APIé¡¹ç›®å¼€å‘</li>
                <li>APIçš„æµ‹è¯•å’Œæ–‡æ¡£ç”Ÿæˆ</li>
            </ol>
        </div>

        <div class="intro" style="margin-top: 40px;">
            <h3>ğŸš€ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®</h3>
            <ul style="text-align: left; margin-left: 40px;">
                <li>æ·±å…¥å­¦ä¹ DRFçš„é«˜çº§ç‰¹æ€§ï¼ˆé™æµã€ç¼“å­˜ã€ç‰ˆæœ¬æ§åˆ¶ï¼‰</li>
                <li>å­¦ä¹ ä½¿ç”¨Celeryå¤„ç†å¼‚æ­¥ä»»åŠ¡</li>
                <li>å­¦ä¹ Dockerå®¹å™¨åŒ–éƒ¨ç½²</li>
                <li>å­¦ä¹ ä½¿ç”¨Redisåšç¼“å­˜å’ŒSessionå­˜å‚¨</li>
                <li>å­¦ä¹ å‰ç«¯æ¡†æ¶ï¼ˆVue/Reactï¼‰ä¸DRFå¯¹æ¥</li>
                <li>å­¦ä¹ APIæ€§èƒ½ä¼˜åŒ–å’Œå®‰å…¨é˜²æŠ¤</li>
            </ul>
        </div>

        <div class="note" style="margin-top: 30px;">
            <strong>ğŸ’¾ ä¿å­˜æç¤ºï¼š</strong>
            <p>æ­¤æ–‡æ¡£å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„"æ‰“å°"åŠŸèƒ½ä¿å­˜ä¸ºPDFï¼š</p>
            <ol>
                <li>æŒ‰ Ctrl+Pï¼ˆWindowsï¼‰æˆ– Cmd+Pï¼ˆMacï¼‰</li>
                <li>é€‰æ‹©"å¦å­˜ä¸ºPDF"</li>
                <li>è°ƒæ•´é¡µé¢è®¾ç½®ï¼Œå–æ¶ˆ"é¡µçœ‰å’Œé¡µè„š"</li>
                <li>ç‚¹å‡»"ä¿å­˜"</li>
            </ol>
        </div>

    </div>
</body>
</html>

